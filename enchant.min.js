/*
Copyright (c) Ubiquitous Entertainment Inc.
Dual licensed under the MIT or GPL Version 3 licenses
http://www.opensource.org/licenses/mit-license.php
http://www.gnu.org/licenses/gpl-3.0.html
*/
var enchant=function(){for(var k in enchant)enchant.hasOwnProperty(k)&&(window[k]=enchant[k])};
(function(){if(typeof Object.defineProperty!="function")Object.defineProperty=function(a,b,d){if("value"in d)a[b]=d.value;"get"in d&&a.__defineGetter__(b,d.get);"set"in d&&a.__defineSetter__(b,d.set);return a};if(typeof Object.defineProperties!="function")Object.defineProperties=function(a,b){for(var d in b)b.hasOwnProperty(d)&&Object.defineProperty(a,d,b[d]);return a};if(typeof Object.create!="function")Object.create=function(a,b){function d(){}d.prototype=a;var c=new d;b!=null&&Object.defineProperties(c,
b);return c};var k=function(){var a=navigator.userAgent;return a.indexOf("Opera")!=-1?"O":a.indexOf("MSIE")!=-1?"ms":a.indexOf("WebKit")!=-1?"webkit":navigator.product=="Gecko"?"Moz":""}(),m=function(){var a=document.createElement("div");a.setAttribute("ontouchstart","return");return typeof a.ontouchstart=="function"}(),e;enchant.Class=function(a,b){return enchant.Class.create(a,b)};enchant.Class.create=function(a,b){if(arguments.length==0)return enchant.Class.create(Object,b);else if(arguments.length==
1&&typeof arguments[0]!="function")return enchant.Class.create(Object,arguments[0]);for(var d in b)typeof b[d]!="object"&&(b[d]={value:b[d]});var c=function(){if(this instanceof c)c.prototype.initialize.apply(this,arguments);else return new c};c.prototype=Object.create(a.prototype,b);c.prototype.constructor=c;if(c.prototype.initialize==null)c.prototype.initialize=function(){a.call(this,arguments)};return c};enchant.Event=enchant.Class.create({initialize:function(a){this.type=a;this.target=null;this.localY=
this.localX=this.y=this.x=0},_initPosition:function(a,b){this.x=this.localX=(a-e._pageX)/e.scale;this.y=this.localY=(b-e._pageY)/e.scale}});enchant.Event.LOAD="load";enchant.Event.PROGRESS="progress";enchant.Event.ENTER_FRAME="enterframe";enchant.Event.ENTER="enter";enchant.Event.EXIT="exit";enchant.Event.ADDED="added";enchant.Event.ADDED_TO_SCENE="addedtoscene";enchant.Event.REMOVED="removed";enchant.Event.REMOVED_FROM_SCENE="removedfromscene";enchant.Event.TOUCH_START="touchstart";enchant.Event.TOUCH_MOVE=
"touchmove";enchant.Event.TOUCH_END="touchend";enchant.Event.RENDER="render";enchant.Event.LEFT_BUTTON_DOWN="leftbuttondown";enchant.Event.LEFT_BUTTON_UP="leftbuttonup";enchant.Event.RIGHT_BUTTON_DOWN="rightbuttondown";enchant.Event.RIGHT_BUTTON_UP="rightbuttonup";enchant.Event.UP_BUTTON_DOWN="upbuttondown";enchant.Event.UP_BUTTON_UP="upbuttonup";enchant.Event.DOwN_BUTTON_DOWN="downbuttondown";enchant.Event.DOwN_BUTTON_UP="downbuttonup";enchant.Event.A_BUTTON_DOWN="abuttondown";enchant.Event.A_BUTTON_UP=
"abuttonup";enchant.Event.B_BUTTON_DOWN="bbuttondown";enchant.Event.B_BUTTON_UP="bbuttonup";enchant.EventTarget=enchant.Class.create({initialize:function(){this._listeners={}},addEventListener:function(a,b){var d=this._listeners[a];d==null?this._listeners[a]=[b]:d.indexOf(b)==-1&&d.unshift(b)},removeEventListner:function(a,b){var d=this._listeners[a];if(d!=null){var c=d.indexOf(b);c!=-1&&d.splice(c,1)}},dispatchEvent:function(a){a.target=this;a.localX=a.x-this._offsetX;a.localY=a.y-this._offsetY;
if(this["on"+a.type]!=null)this["on"+a.type]();var b=this._listeners[a.type];if(b!=null)for(var d=0,c=b.length;d<c;d++)b[d].call(this,a)}});enchant.Game=enchant.Class.create(enchant.EventTarget,{initialize:function(a,b){enchant.EventTarget.call(this);var d=!0;e&&(d=!1,e.stop());e=this;this.width=a||320;this.height=b||320;this.scale=1;var c=document.getElementById("enchant-stage");if(c){var f=window.getComputedStyle(c);f.width&&f.height?this.scale=Math.min(parseInt(f.width)/this.width,parseInt(f.height)/
this.height):(c.style.width=this.width+"px",c.style.height=this.height+"px");for(;c.firstChild;)c.removeChild(c.firstChild);c.style.position="relative"}else c=document.createElement("div"),c.id="enchant-stage",c.style.width=window.innerWidth+"px",c.style.height=window.innerHeight+"px",c.style.position="absolute",document.body.firstChild?document.body.insertBefore(c,document.body.firstChild):document.body.appendChild(c),this.scale=Math.min(window.innerWidth/this.width,window.innerHeight/this.height);
c.style.overflow="hidden";f=c.getBoundingClientRect();this._pageX=Math.round(window.scrollX+f.left);this._pageY=Math.round(window.scrollY+f.top);this._element=c;this.fps=30;this.frame=0;this.ready=null;this.running=!1;this.assets={};this.debug=!1;this._scenes=[];this.currentScene=this.loadingScene=null;this.rootScene=new enchant.Scene;this.pushScene(this.rootScene);this._surface_id=this._mousedown_id=0;this.input={};this._keybind={};this.keybind(37,"left");this.keybind(38,"up");this.keybind(39,"right");
this.keybind(40,"down");this.addEventListener("leftbuttondown",function(a){this.input.left=!0;this.currentScene.dispatchEvent(a)});this.addEventListener("leftbuttonup",function(a){this.input.left=!1;this.currentScene.dispatchEvent(a)});this.addEventListener("rightbuttondown",function(a){this.input.right=!0;this.currentScene.dispatchEvent(a)});this.addEventListener("rightbuttonup",function(a){this.input.right=!1;this.currentScene.dispatchEvent(a)});this.addEventListener("upbuttondown",function(a){this.input.up=
!0;this.currentScene.dispatchEvent(a)});this.addEventListener("upbuttonup",function(a){this.input.up=!1;this.currentScene.dispatchEvent(a)});this.addEventListener("downbuttondown",function(a){this.input.down=!0;this.currentScene.dispatchEvent(a)});this.addEventListener("downbuttonup",function(a){this.input.down=!1;this.currentScene.dispatchEvent(a)});this.addEventListener("abuttondown",function(a){this.input.a=!0;this.currentScene.dispatchEvent(a)});this.addEventListener("abuttonup",function(a){this.input.a=
!1;this.currentScene.dispatchEvent(a)});this.addEventListener("bbuttondown",function(a){this.input.b=!0;this.currentScene.dispatchEvent(a)});this.addEventListener("bbuttonup",function(a){this.input.b=!1;this.currentScene.dispatchEvent(a)});d&&(document.addEventListener("keydown",function(a){if(e.running&&(a=e._keybind[a.keyCode]))a=new enchant.Event(a+"buttondown"),e.currentScene.dispatchEvent(a),e.dispatchEvent(a)},!0),document.addEventListener("keyup",function(a){if(e.running&&(a=e._keybind[a.keyCode]))a=
new enchant.Event(a+"buttonup"),e.currentScene.dispatchEvent(a),e.dispatchEvent(a)},!0),m?(document.addEventListener("touchstart",function(a){a.preventDefault();e.running||a.stopPropagation()},!0),document.addEventListener("touchmove",function(a){a.preventDefault();e.running||a.stopPropagation()},!0),document.addEventListener("touchend",function(a){a.preventDefault();e.running||a.stopPropagation()},!0)):(document.addEventListener("mousedown",function(a){a.preventDefault();e._mousedown_id++;e.running||
a.stopPropagation()},!0),document.addEventListener("mousemove",function(a){a.preventDefault();e.running||a.stopPropagation()},!0),document.addEventListener("mouseup",function(a){a.preventDefault();e.running||a.stopPropagation()},!0)))},preload:function(a){if(!(this.ready!=null||a==null)){a instanceof Array||(a=Array.prototype.slice.call(arguments));if(this.loadingScene==null){var b=this.loadingScene=new enchant.Scene;b.backgroundColor="#000";var d=e.width*0.9|0,c=e.width*0.3|0,f=d*0.05|0,h=new enchant.Sprite(d,
c);h.x=(e.width-d)/2;h.y=(e.height-c)/2;var g=new enchant.Surface(d,c);g.context.fillStyle="#fff";g.context.fillRect(0,0,d,c);g.context.fillStyle="#000";g.context.fillRect(f,f,d-f*2,c-f*2);h.image=g;var i=0,j=0;this.addEventListener("progress",function(a){i=a.loaded/a.total});h.addEventListener("enterframe",function(){j*=0.9;j+=i*0.1;g.context.fillStyle="#fff";g.context.fillRect(f,0,(d-f*2)*j,c)});b.addChild(h)}this.pushScene(this.loadingScene);var l=0;a.forEach(function(b){var d=new Image;d.src=
b;d.onerror=function(){};d.onload=function(){e.assets[b]=Object.create(Surface.prototype,{width:{value:d.width},height:{value:d.height},_css:{value:"url("+d.src+")"},_element:{value:d}});var c=new enchant.Event("progress");c.loaded=++l;c.total=a.length;e.dispatchEvent(c);if(l==a.length)e.popScene(),e.ready=!0,e.dispatchEvent(new enchant.Event("load"))}});this.ready=!1}},start:function(){this._intervalID&&window.clearInterval(this._intervalID);this.currentTime=Date.now();this._intervalID=window.setInterval(function(){e._tick()},
1E3/this.fps);this.running=!0},stop:function(){if(this._intervalID)window.clearInterval(this._intervalID),this._intervalID=null;this.running=!1},pause:function(){if(this._intervalID)window.clearInterval(this._intervalID),this._intervalID=null},_tick:function(){var a=Date.now(),b=new enchant.Event("enterframe");b.frame=this.frame;b.elapsed=a-this.currentTime;this.currentTime=a;for(var a=this.currentScene.childNodes.slice(),d=Array.prototype.push;a.length;){var c=a.pop();c.dispatchEvent(b);c.childNodes&&
d.apply(a,c.childNodes)}this.currentScene.dispatchEvent(b);this.dispatchEvent(b);this.frame++},pushScene:function(a){this._element.appendChild(a._element);this.currentScene&&this.currentScene.dispatchEvent(new enchant.Event("exit"));this.currentScene=a;this.currentScene.dispatchEvent(new enchant.Event("enter"));return this._scenes.push(a)},popScene:function(){if(this.currentScene!==this.rootScene)return this._element.removeChild(this.currentScene._element),this.currentScene.dispatchEvent(new enchant.Event("exit")),
this.currentScene=this._scenes[this._scenes.length-2],this.currentScene.dispatchEvent(new enchant.Event("enter")),this._scenes.pop()},replaceScene:function(a){this.popScene();return this.pushScene(a)},keybind:function(a,b){this._keybind[a]=b}});enchant.Node=enchant.Class.create(enchant.EventTarget,{initialize:function(){enchant.EventTarget.call(this);this._offsetY=this._offsetX=this._y=this._x=0;this.scene=this.parentNode=null;this.game=e;this.addEventListener("touchstart",function(a){this.parentNode&&
this.parentNode==this.scene&&this.parentNode.dispatchEvent(a)});this.addEventListener("touchmove",function(a){this.parentNode&&this.parentNode==this.scene&&this.parentNode.dispatchEvent(a)});this.addEventListener("touchend",function(a){this.parentNode&&this.parentNode==this.scene&&this.parentNode.dispatchEvent(a)})},moveTo:function(a,b){this._x=a;this._y=b;this._updateCoordinate()},moveBy:function(a,b){this._x+=a;this._y+=b;this._updateCoordinate()},x:{get:function(){return this._x},set:function(a){this._x=
a;this._updateCoordinate()}},y:{get:function(){return this._y},set:function(a){this._y=a;this._updateCoordinate()}},_updateCoordinate:function(){this.parentNode?(this._offsetX=this.parentNode._offsetX+this._x,this._offsetY=this.parentNode._offsetY+this._y):(this._offsetX=this._x,this._offsetY=this._y)}});enchant.Entity=enchant.Class.create(enchant.Node,{initialize:function(){enchant.Node.call(this);this._element=document.createElement("div");this._style=this._element.style;this._style.position="absolute";
this._height=this._width=0;this._backgroundColor=null;this._opacity=1;this._visible=!0;this._buttonMode=null;this.buttonPressed=!1;var a=this,b=function(){a.dispatchEvent(new enchant.Event("render"))};this.addEventListener("addedtoscene",function(){e.addEventListener("enterframe",b)});this.addEventListener("removedfromscene",function(){e.removeEventListner("enterframe",b)});this.addEventListener("render",function(){if(this._offsetX!=this._previousOffsetX)this._style.left=this._offsetX+"px";if(this._offsetY!=
this._previousOffsetY)this._style.top=this._offsetY+"px";this._previousOffsetX=this._offsetX;this._previousOffsetY=this._offsetY});a=this;m?(this._element.addEventListener("touchstart",function(b){for(var c=b.touches,f=0,e=c.length;f<e;f++)b=new enchant.Event("touchstart"),b.identifier=c[f].identifier,b._initPosition(c[f].pageX,c[f].pageY),a.dispatchEvent(b)},!1),this._element.addEventListener("touchmove",function(b){for(var c=b.touches,f=0,e=c.length;f<e;f++)b=new enchant.Event("touchmove"),b.identifier=
c[f].identifier,b._initPosition(c[f].pageX,c[f].pageY),a.dispatchEvent(b)},!1),this._element.addEventListener("touchend",function(b){for(var c=b.changedTouches,f=0,e=c.length;f<e;f++)b=new enchant.Event("touchend"),b.identifier=c[f].identifier,b._initPosition(c[f].pageX,c[f].pageY),a.dispatchEvent(b)},!1)):(this._element.addEventListener("mousedown",function(b){var c=b.pageX,f=b.pageY,b=new enchant.Event("touchstart");b.identifier=e._mousedown_id;b._initPosition(c,f);a.dispatchEvent(b);a._mousedown=
!0},!1),e._element.addEventListener("mousemove",function(b){if(a._mousedown){var c=b.pageX,f=b.pageY,b=new enchant.Event("touchmove");b.identifier=e._mousedown_id;b._initPosition(c,f);a.dispatchEvent(b)}},!1),e._element.addEventListener("mouseup",function(b){if(a._mousedown){var c=b.pageX,f=b.pageY,b=new enchant.Event("touchend");b.identifier=e._mousedown_id;b._initPosition(c,f);a.dispatchEvent(b);a._mousedown=!1}},!1))},width:{get:function(){return this._width},set:function(a){this._style.width=
(this._width=a)+"px"}},height:{get:function(){return this._height},set:function(a){this._style.height=(this._height=a)+"px"}},backgroundColor:{get:function(){return this._backgroundColor},set:function(a){this._element.style.backgroundColor=this._backgroundColor=a}},opacity:{get:function(){return this._opacity},set:function(a){this._style.opacity=this._opacity=a}},visible:{get:function(){return this._visible},set:function(a){this._style.display=(this._visible=a)?"block":"none"}},touchEnabled:{get:function(){return this._touchEnabled},
set:function(a){this._style.pointerEvents=(this._touchEnabled=a)?"all":"none"}},buttonMode:{get:function(){return this._buttonMode},set:function(a){if(this._buttonMode!=a){this._buttonMode!=null&&(this.removeEventListner("touchstart",this._buttondown),this.removeEventListner("touchend",this._buttonup));if(a!=null)this._buttondown=function(){this.buttonPressed=!0;var b=new Event(a+"buttondown");this.dispatchEvent(b);e.dispatchEvent(b)},this._buttonup=function(){this.buttonPressed=!1;var b=new Event(a+
"buttonup");this.dispatchEvent(b);e.dispatchEvent(b)},this.addEventListener("touchstart",this._buttondown),this.addEventListener("touchend",this._buttonup);this._buttonMode=a}}},intersect:function(a){return this.x<a.x+a.width&&a.x<this.x+this.width&&this.y<a.y+a.height&&a.y<this.y+this.height},within:function(a,b){b==null&&(b=(this.width+this.height+a.width+a.height)/4);var d;return(d=this.x+this.width*0.5-a.x-a.width*0.5)*d+(d=this.y+this.height*0.5-a.y-a.height*0.5)*d<b*b}});enchant.Sprite=enchant.Class.create(enchant.Entity,
{initialize:function(a,b){enchant.Entity.call(this);this.width=a;this.height=b;this._scaleY=this._scaleX=1;this._rotation=0;this._dirty=!1;this._image=null;this._frame=0;this._style.overflow="hidden";this.addEventListener("render",function(){if(this._dirty)this._style[k+"Transform"]=["rotate(",this._rotation,"deg)scale(",this._scaleX,",",this._scaleY,")"].join(""),this._dirty=!1})},image:{get:function(){return this._image},set:function(a){if(a!=null)if(a._css)this._style.backgroundImage=a._css;else if(a._parent){var b=
document.createElement("canvas"),d=b.getContext("2d");b.width=a.width;b.height=a.height;d.drawImage(a._element,0,0);this._dirtyListener=function(){if(a._dirty)d.drawImage(a._element),a._dirty=!1};this.addEventListener("render",this._dirtyListener);this._element.appendChild(b)}else a._parent=this,this._element.appendChild(a._element);else this._element.firstChild?(this._element.removeChild(this._element.firstChild),this._dirtyListener?(this.removeEventListner("render",this._dirtyListener),this._dirtyListener=
null):this._image._parent=null):this._style.backgroundImage="";this._image=a}},frame:{get:function(){return this._frame},set:function(a){this._frame=a;var b=this._image.width/this._width|0;if(this._element.firstChild){var d=this._element.firstChild.style;d.left=-(a%b)*this._width+"px";d.top=-(a/b|0)*this._height+"px"}else this._style.backgroundPosition=[-(a%b)*this._width,"px ",-(a/b|0)*this._height,"px"].join("")}},scale:function(a,b){b==null&&(b=a);this._scaleX*=a;this._scaleY*=b;this._dirty=!0},
rotate:function(a){this._rotation+=a;this._dirty=!0},scaleX:{get:function(){return this._scaleX},set:function(a){this._scaleX=a;this._dirty=!0}},scaleY:{get:function(){return this._scaleY},set:function(a){this._scaleY=a;this._dirty=!0}},rotation:{get:function(){return this._rotation},set:function(a){this._rotation=a;this._dirty=!0}}});enchant.Label=enchant.Class.create(enchant.Entity,{initialize:function(a){enchant.Entity.call(this);this.width=300;this.text=a},text:{get:function(){return this._element.innerHTML},
set:function(a){this._element.innerHTML=a}},font:{get:function(){return this._style.font},set:function(a){this._style.font=a}},color:{get:function(){return this._style.color},set:function(a){this._style.color=a}}});enchant.Map=enchant.Class.create(enchant.Entity,{initialize:function(a,b){enchant.Entity.call(this);var d=document.createElement("canvas");d.width=e.width;d.height=e.height;this._element.appendChild(d);this._context=d.getContext("2d");this._tileWidth=a||0;this._tileHeight=b||0;this._image=
null;this._data=[[[]]];this.touchEnabled=this._dirty=!1;this.collisionData=null;this._listeners.render=null;this.addEventListener("render",function(){(this._offsetX!=this._previousOffsetX||this._offsetY!=this._previousOffsetY||this._dirty)&&this.redraw();this._previousOffsetX=this._offsetX;this._previousOffsetY=this._offsetY})},loadData:function(){this._data=Array.prototype.slice.apply(arguments);this._dirty=!0},hitTest:function(a,b){if(a<0||this.width<=a||b<0||this.height<=b)return!1;var d=this._image.width,
c=this._image.height,e=this._tileWidth||d,h=this._tileHeight||c,a=a/e|0,b=b/h|0;if(this.collisionData!=null)return this.collisionData[b]&&!!this.collisionData[b][a];else{for(var g=0,i=this._data.length;g<i;g++){var j=this._data[g],l;if(j[b]!=null&&(l=j[b][a])!=null&&0<=l&&l<(d/e|0)*(c/h|0))return!0}return!1}},image:{get:function(){return this._image},set:function(a){this._image=a;this._dirty=!0}},tileWidth:{get:function(){return this._tileWidth},set:function(a){this._tileWidth=a;this._dirty=!0}},
tileHeight:{get:function(){return this._tileHeight},set:function(a){this._tileHeight=a;this._dirty=!0}},width:{get:function(){return this._tileWidth*this._data[0][0].length}},height:{get:function(){return this._tileHeight*this._data[0].length}},redraw:function(){if(this._image!=null){var a=this._image._element,b=this._context,d=e.width,c=e.height,f=-this._offsetX,h=-this._offsetY,g=this._tileWidth||this._image.width,i=this._tileHeight||this._image.height,j=this._image.width/g|0,l=this._image.height/
i|0,k=Math.max(f/g|0,0),m=Math.max(h/i|0,0);b.clearRect(0,0,d,c);for(var q=0,s=this._data.length;q<s;q++)for(var r=this._data[q],t=Math.min(Math.ceil((f+d)/g),r[0].length),u=Math.min(Math.ceil((h+c)/i),r.length),n=m;n<u;n++)for(var o=k;o<t;o++){var p=r[n][o];0<=p&&p<j*l&&b.drawImage(a,p%j*g,(p/j|0)*i,g,i,o*g-f,n*i-h,g,i)}this._dirty=!1}}});enchant.Group=enchant.Class.create(enchant.Node,{initialize:function(){enchant.Node.call(this);this.childNodes=[];this._y=this._x=0},addChild:function(a){a.parentNode=
this;this.childNodes.push(a);a.dispatchEvent(new enchant.Event("added"));if(this.scene){var b=new enchant.Event("addedtoscene");a.scene=this.scene;a.dispatchEvent(b);a._updateCoordinate();var d=document.createDocumentFragment(),c,e=Array.prototype.push;if(a.childNodes)for(c=a.childNodes.slice().reverse();c.length;)a=c.pop(),a.scene=this.scene,a.dispatchEvent(b),a._element&&d.appendChild(a._element),a.childNodes&&e.apply(c,a.childNodes.reverse());else d.appendChild(a._element);if(d.childNodes.length){var h;
if(this.parentNode){c=this.parentNode.childNodes;for(c=c.slice(c.indexOf(this)+1).reverse();c.length;)if(a=c.pop(),a.childNodes)e.apply(c,a.childNodes.slice().reverse());else{h=a;break}}h?this.scene._element.insertBefore(d,h):this.scene._element.appendChild(d)}}},removeChild:function(a){var b=this.childNodes.indexOf(a);if(b!=-1&&(this.childNodes.splice(b,1),a.parentNode=null,a.dispatchEvent(new enchant.Event("removed")),this.scene))if(b=new enchant.Event("removedfromscene"),a.scene=null,a.dispatchEvent(b),
a.childNodes)for(var d=a.childNodes.slice(),c=Array.prototype.push;d.length;)a=d.pop(),a.scene=null,a.dispatchEvent(b),this.scene._element.removeChild(a._element),a.childNodes&&c.apply(d,a.childNodes);else this.scene._element.removeChild(a._element)},firstChild:{get:function(){return this.childNodes[0]}},lastChild:{get:function(){return this.childNodes[this.childNodes.length-1]}},_updateCoordinate:function(){this.parentNode?(this._offsetX=this.parentNode._offsetX+this._x,this._offsetY=this.parentNode._offsetY+
this._y):(this._offsetX=this._x,this._offsetY=this._y);for(var a=0,b=this.childNodes.length;a<b;a++)this.childNodes[a]._updateCoordinate()}});enchant.Scene=enchant.Class.create(enchant.Group,{initialize:function(){enchant.Group.call(this);this._element=document.createElement("div");this._element.style.position="absolute";this._element.style.width=e.width+"px";this._element.style.height=e.height+"px";this._element.style[k+"TransformOrigin"]="0 0";this._element.style[k+"Transform"]="scale("+e.scale+
")";this.scene=this;var a=this;m?(this._element.addEventListener("touchstart",function(b){for(var d=b.touches,c=0,e=d.length;c<e;c++)b=new enchant.Event("touchstart"),b.identifier=d[c].identifier,b._initPosition(d[c].pageX,d[c].pageY),a.dispatchEvent(b)},!1),this._element.addEventListener("touchmove",function(b){for(var d=b.touches,c=0,e=d.length;c<e;c++)b=new enchant.Event("touchmove"),b.identifier=d[c].identifier,b._initPosition(d[c].pageX,d[c].pageY),a.dispatchEvent(b)},!1),this._element.addEventListener("touchend",
function(b){for(var d=b.changedTouches,c=0,e=d.length;c<e;c++)b=new enchant.Event("touchend"),b.identifier=d[c].identifier,b._initPosition(d[c].pageX,d[c].pageY),a.dispatchEvent(b)},!1)):(this._element.addEventListener("mousedown",function(b){var d=b.pageX,c=b.pageY,b=new enchant.Event("touchstart");b.identifier=e._mousedown_id;b._initPosition(d,c);a.dispatchEvent(b);a._mousedown=!0},!1),e._element.addEventListener("mousemove",function(b){if(a._mousedown){var d=b.pageX,c=b.pageY,b=new enchant.Event("touchmove");
b.identifier=e._mousedown_id;b._initPosition(d,c);a.dispatchEvent(b)}},!1),e._element.addEventListener("mouseup",function(b){if(a._mousedown){var d=b.pageX,c=b.pageY,b=new enchant.Event("touchend");b.identifier=e._mousedown_id;b._initPosition(d,c);a.dispatchEvent(b);a._mousedown=!1}},!1))},backgroundColor:{get:function(){return this._backgroundColor},set:function(a){this._element.style.backgroundColor=this._backgroundColor=a}},_updateCoordinate:function(){this._offsetX=this._x;this._offsetY=this._y;
for(var a=0,b=this.childNodes.length;a<b;a++)this.childNodes[a]._updateCoordinate()}});enchant.Surface=enchant.Class.create({initialize:function(a,b){this.width=a;this.height=b;this.context=null;var d="enchant-surface"+e._surface_id++;if(document.getCSSCanvasContext)this.context=document.getCSSCanvasContext("2d",d,a,b),this._element=this.context.canvas,this._css="-webkit-canvas("+d+")";else if(document.mozSetImageElement)this._element=document.createElement("canvas"),this._element.width=a,this._element.height=
b,this._css="-moz-element(#"+d+")",this.context=this._element.getContext("2d"),document.mozSetImageElement(d,this._element);else{this._element=document.createElement("canvas");this._element.width=a;this._element.height=b;this._element.style.position="absolute";this.context=this._element.getContext("2d");for(var c=this,d=["putImageData","drawImage","drawFocusRing","fill","stroke","clearRect","fillRect","strokeRect","fillText","strokeText"],f=0,h=d.length;f<h;f++)(function(a){var b=c.context[a];c.context[a]=
function(){b.apply(this,arguments);c._dirty=!0}})(d[f])}},getPixel:function(a,b){return this.context.getImageData(a,b,1,1).data},setPixel:function(a,b,d,c,e,h){var g=this.context.createImageData(1,1);g.data[0]=d;g.data[1]=c;g.data[2]=e;g.data[3]=h;this.context.putImageData(g,a,b,1,1)},clear:function(){this.context.clearRect(0,0,this.width,this.height)},draw:function(a){arguments[0]=a=a._element;arguments.length==1?this.context.drawImage(a,0,0):this.context.drawImage.apply(this.context,arguments)},
clone:function(){var a=new enchant.Surface(this.width,this,height);a.draw(this);return a}})})();

/*
enchant.js v0.4.3
Copyright (c) Ubiquitous Entertainment Inc.
Dual licensed under the MIT or GPL Version 3 licenses
http://www.opensource.org/licenses/mit-license.php
http://www.gnu.org/licenses/gpl-3.0.html
*/
<<<<<<< HEAD
if("function"!=typeof Object.defineProperty)Object.defineProperty=function(f,m,j){if("value"in j)f[m]=j.value;"get"in j&&f.__defineGetter__(m,j.get);"set"in j&&f.__defineSetter__(m,j.set);return f};if("function"!=typeof Object.defineProperties)Object.defineProperties=function(f,m){for(var j in m)m.hasOwnProperty(j)&&Object.defineProperty(f,j,m[j]);return f};
if("function"!=typeof Object.create)Object.create=function(f,m){function j(){}j.prototype=f;var e=new j;null!=m&&Object.defineProperties(e,m);return e};if("function"!=typeof Object.getPrototypeOf)Object.getPrototypeOf=function(f){return f.__proto__};
var enchant=function(f){null!=f&&(f instanceof Array||(f=Array.prototype.slice.call(arguments)),f=f.filter(function(f){return""+f}));(function j(e,o){var a=[],b;for(b in e)e.hasOwnProperty(b)&&("function"==typeof e[b]?window[b]=e[b]:Object.getPrototypeOf(e[b])==Object.prototype&&(null==f?a.push(b):(c=f.indexOf(o+b),-1!=c&&(a.push(b),f.splice(c,1)))));var c=0;for(b=a.length;c<b;c++)j(e[a[c]],o+a[c]+".")})(enchant,"");if(null!=f&&f.length)throw Error("Cannot load module: "+f.join(", "));};
(function(){var f=function(){var a=navigator.userAgent;return-1!=a.indexOf("Opera")?"O":-1!=a.indexOf("MSIE")?"ms":-1!=a.indexOf("WebKit")?"webkit":"Gecko"==navigator.product?"Moz":""}(),m=function(){var a=document.createElement("div");a.setAttribute("ontouchstart","return");return"function"==typeof a.ontouchstart}(),j=function(){if(-1!=navigator.userAgent.indexOf("iPhone")&&2==window.devicePixelRatio){var a=document.querySelector('meta[name="viewport"]');null==a&&(a=document.createElement("meta"),
document.head.appendChild(a));a.setAttribute("content","width=640px");return!0}return!1}(),e;enchant.Class=function(a,b){return enchant.Class.create(a,b)};enchant.Class.create=function(a,b){if(0==arguments.length)return enchant.Class.create(Object,b);if(1==arguments.length&&"function"!=typeof arguments[0])return enchant.Class.create(Object,arguments[0]);for(var c in b)if(b.hasOwnProperty(c))if(Object.getPrototypeOf(b[c])==Object.prototype){if(!("enumerable"in b[c]))b[c].enumerable=!0}else b[c]={value:b[c],
enumerable:!0,writable:!0};var d=function(){if(this instanceof d)d.prototype.initialize.apply(this,arguments);else return new d};d.prototype=Object.create(a.prototype,b);d.prototype.constructor=d;if(null==d.prototype.initialize)d.prototype.initialize=function(){a.apply(this,arguments)};return d};enchant.Event=enchant.Class.create({initialize:function(a){this.type=a;this.target=null;this.localY=this.localX=this.y=this.x=0},_initPosition:function(a,b){this.x=this.localX=(a-e._pageX)/e.scale;this.y=
this.localY=(b-e._pageY)/e.scale}});enchant.Event.LOAD="load";enchant.Event.PROGRESS="progress";enchant.Event.ENTER_FRAME="enterframe";enchant.Event.EXIT_FRAME="exitframe";enchant.Event.ENTER="enter";enchant.Event.EXIT="exit";enchant.Event.ADDED="added";enchant.Event.ADDED_TO_SCENE="addedtoscene";enchant.Event.REMOVED="removed";enchant.Event.REMOVED_FROM_SCENE="removedfromscene";enchant.Event.TOUCH_START="touchstart";enchant.Event.TOUCH_MOVE="touchmove";enchant.Event.TOUCH_END="touchend";enchant.Event.RENDER=
"render";enchant.Event.INPUT_START="inputstart";enchant.Event.INPUT_CHANGE="inputchange";enchant.Event.INPUT_END="inputend";enchant.Event.LEFT_BUTTON_DOWN="leftbuttondown";enchant.Event.LEFT_BUTTON_UP="leftbuttonup";enchant.Event.RIGHT_BUTTON_DOWN="rightbuttondown";enchant.Event.RIGHT_BUTTON_UP="rightbuttonup";enchant.Event.UP_BUTTON_DOWN="upbuttondown";enchant.Event.UP_BUTTON_UP="upbuttonup";enchant.Event.DOWN_BUTTON_DOWN="downbuttondown";enchant.Event.DOWN_BUTTON_UP="downbuttonup";enchant.Event.A_BUTTON_DOWN=
"abuttondown";enchant.Event.A_BUTTON_UP="abuttonup";enchant.Event.B_BUTTON_DOWN="bbuttondown";enchant.Event.B_BUTTON_UP="bbuttonup";enchant.EventTarget=enchant.Class.create({initialize:function(){this._listeners={}},addEventListener:function(a,b){var c=this._listeners[a];null==c?this._listeners[a]=[b]:-1==c.indexOf(b)&&c.unshift(b)},removeEventListener:function(a,b){var c=this._listeners[a];if(null!=c){var d=c.indexOf(b);-1!=d&&c.splice(d,1)}},clearEventListener:function(a){null!=a?delete this._listeners[a]:
this._listeners={}},dispatchEvent:function(a){a.target=this;a.localX=a.x-this._offsetX;a.localY=a.y-this._offsetY;if(null!=this["on"+a.type])this["on"+a.type]();var b=this._listeners[a.type];if(null!=b)for(var b=b.slice(),c=0,d=b.length;c<d;c++)b[c].call(this,a)}});enchant.Game=enchant.Class.create(enchant.EventTarget,{initialize:function(a,b){enchant.EventTarget.call(this);var c=!0;e&&(c=!1,e.stop());e=enchant.Game.instance=this;this.width=a||320;this.height=b||320;this.scale=1;var d=document.getElementById("enchant-stage");
if(d){var g=window.getComputedStyle(d),a=parseInt(g.width),b=parseInt(g.height);a&&b?this.scale=Math.min(a/this.width,b/this.height):(d.style.width=this.width+"px",d.style.height=this.height+"px");for(;d.firstChild;)d.removeChild(d.firstChild);d.style.position="relative";g=d.getBoundingClientRect();this._pageX=Math.round(window.scrollX+g.left);this._pageY=Math.round(window.scrollY+g.top)}else d=document.createElement("div"),d.id="enchant-stage",d.style.width=window.innerWidth+"px",d.style.height=
window.innerHeight+"px",d.style.position="absolute",document.body.firstChild?document.body.insertBefore(d,document.body.firstChild):document.body.appendChild(d),this.scale=Math.min(window.innerWidth/this.width,window.innerHeight/this.height),this._pageY=this._pageX=0;if(!this.scale)this.scale=1;d.style.fontSize="12px";d.style.webkitTextSizeAdjust="none";this._element=d;this.fps=30;this.frame=0;this.ready=null;this.running=!1;this.assets={};var h=this._assets=[];(function q(a){a.assets instanceof Array&&
[].push.apply(h,a.assets);for(var b in a)a.hasOwnProperty(b)&&Object.getPrototypeOf(a[b])==Object.prototype&&q(a[b])})(enchant);this._scenes=[];this.currentScene=null;this.rootScene=new enchant.Scene;this.pushScene(this.rootScene);this.loadingScene=new enchant.Scene;this.loadingScene.backgroundColor="#000";var i=0.9*this.width|0,n=0.3*this.width|0,k=0.05*i|0,d=new enchant.Sprite(i,n);d.x=(this.width-i)/2;d.y=(this.height-n)/2;var l=new enchant.Surface(i,n);l.context.fillStyle="#fff";l.context.fillRect(0,
0,i,n);l.context.fillStyle="#000";l.context.fillRect(k,k,i-2*k,n-2*k);d.image=l;var f=0,j=0;this.addEventListener("progress",function(a){f=a.loaded/a.total});d.addEventListener("enterframe",function(){j*=0.9;j+=0.1*f;l.context.fillStyle="#fff";l.context.fillRect(k,0,(i-2*k)*j,n)});this.loadingScene.addChild(d);this._soundID=this._surfaceID=this._mousedownID=0;this._intervalID=null;this.input={};this._keybind={};this.keybind(37,"left");this.keybind(38,"up");this.keybind(39,"right");this.keybind(40,
"down");var o=0;"left,right,up,down,a,b".split(",").forEach(function(a){this.addEventListener(a+"buttondown",function(b){this.input[a]||(this.input[a]=!0,this.dispatchEvent(new enchant.Event(o++?"inputchange":"inputstart")));this.currentScene.dispatchEvent(b)});this.addEventListener(a+"buttonup",function(b){this.input[a]&&(this.input[a]=!1,this.dispatchEvent(new enchant.Event(--o?"inputchange":"inputend")));this.currentScene.dispatchEvent(b)})},this);c&&(document.addEventListener("keydown",function(a){e.dispatchEvent(new enchant.Event("keydown"));
if(37<=a.keyCode&&40>=a.keyCode||32==a.keyCode)a.preventDefault(),a.stopPropagation();if(e.running&&(a=e._keybind[a.keyCode]))a=new enchant.Event(a+"buttondown"),e.dispatchEvent(a)},!0),document.addEventListener("keyup",function(a){if(e.running&&(a=e._keybind[a.keyCode]))a=new enchant.Event(a+"buttonup"),e.dispatchEvent(a)},!0),m?(document.addEventListener("touchstart",function(a){a.preventDefault()},!0),document.addEventListener("touchmove",function(a){a.preventDefault();e.running||a.stopPropagation()},
!0),document.addEventListener("touchend",function(a){a.preventDefault();e.running||a.stopPropagation()},!0)):(document.addEventListener("mousedown",function(a){a.preventDefault();e._mousedownID++;e.running||a.stopPropagation()},!0),document.addEventListener("mousemove",function(a){a.preventDefault();e.running||a.stopPropagation()},!0),document.addEventListener("mouseup",function(a){a.preventDefault();e.running||a.stopPropagation()},!0)))},preload:function(a){a instanceof Array||(a=Array.prototype.slice.call(arguments));
[].push.apply(this._assets,a)},load:function(a,b){null==b&&(b=function(){});var c=a.match(/\.\w+$/)[0];c&&(c=c.slice(1).toLowerCase());switch(c){case "jpg":case "gif":case "png":e.assets[a]=enchant.Surface.load(a);e.assets[a].addEventListener("load",b);break;case "mp3":case "aac":case "m4a":case "wav":case "ogg":e.assets[a]=enchant.Sound.load(a,"audio/"+c);e.assets[a].addEventListener("load",b);break;default:var d=new XMLHttpRequest;d.open("GET",a,!0);d.onreadystatechange=function(){if(4==d.readyState){if(200!=
d.status&&0!=d.status)throw Error(d.status+": Cannot load an asset: "+a);var c=d.getResponseHeader("Content-Type")||"";c.match(/^image/)?(e.assets[a]=enchant.Surface.load(a),e.assets[a].addEventListener("load",b)):c.match(/^audio/)?(e.assets[a]=enchant.Sound.load(a,c),e.assets[a].addEventListener("load",b)):(e.assets[a]=d.responseText,b())}};d.send(null)}},start:function(){if(this._intervalID)window.clearInterval(this._intervalID);else if(this._assets.length){if(enchant.Sound.enabledInMobileSafari&&
!e._touched&&"webkit"==f&&m){var a=new enchant.Scene;a.backgroundColor="#000";var b=Math.round(e.width/10),c=new enchant.Sprite(e.width,b);c.y=(e.height-b)/2;c.image=new enchant.Surface(e.width,b);c.image.context.fillStyle="#fff";c.image.context.font=b-1+"px bold Helvetica,Arial,sans-serif";var d=c.image.context.measureText("Touch to Start").width;c.image.context.fillText("Touch to Start",(e.width-d)/2,b-1);a.addChild(c);document.addEventListener("touchstart",function(){e._touched=!0;e.removeScene(a);
e.start()},!0);e.pushScene(a);return}var g={},b=this._assets.filter(function(a){return a in g?!1:g[a]=!0}),h=0,c=0,i=b.length;for(;c<i;c++)this.load(b[c],function(){var a=new enchant.Event("progress");a.loaded=++h;a.total=i;e.dispatchEvent(a);h==i&&(e.removeScene(e.loadingScene),e.dispatchEvent(new enchant.Event("load")))});this.pushScene(this.loadingScene)}else this.dispatchEvent(new enchant.Event("load"));this.currentTime=Date.now();this._intervalID=window.setInterval(function(){e._tick()},1E3/
this.fps);this.running=!0},debug:function(){this._debug=!0;this.start()},actualFps:{get:function(){return this._actualFps||this.fps}},_tick:function(){var a=Date.now(),b=new enchant.Event("enterframe");b.elapsed=a-this.currentTime;this.currentTime=a;for(var a=this.currentScene.childNodes.slice(),c=Array.prototype.push;a.length;){var d=a.pop();d.dispatchEvent(b);d.age++;d.childNodes&&c.apply(a,d.childNodes)}this._actualFps=0==b.elapsed?this.fps:Math.round(10*(1E3/b.elapsed))/10;this.currentScene.dispatchEvent(b);
this.dispatchEvent(b);this.dispatchEvent(new enchant.Event("exitframe"));this.frame++},stop:function(){if(this._intervalID)window.clearInterval(this._intervalID),this._intervalID=null;this.running=!1},pause:function(){if(this._intervalID)window.clearInterval(this._intervalID),this._intervalID=null},resume:function(){this.currentTime=Date.now();this._intervalID=window.setInterval(function(){e._tick()},1E3/this.fps);this.running=!0},pushScene:function(a){this._element.appendChild(a._element);this.currentScene&&
this.currentScene.dispatchEvent(new enchant.Event("exit"));this.currentScene=a;this.currentScene.dispatchEvent(new enchant.Event("enter"));return this._scenes.push(a)},popScene:function(){if(this.currentScene!=this.rootScene)return this._element.removeChild(this.currentScene._element),this.currentScene.dispatchEvent(new enchant.Event("exit")),this.currentScene=this._scenes[this._scenes.length-2],this.currentScene.dispatchEvent(new enchant.Event("enter")),this._scenes.pop()},replaceScene:function(a){this.popScene();
return this.pushScene(a)},removeScene:function(a){if(this.currentScene==a)return this.popScene();var b=this._scenes.indexOf(a);if(-1!=b)return this._scenes.splice(b,1),this._element.removeChild(a._element),a},keybind:function(a,b){this._keybind[a]=b}});enchant.Game.instance=null;enchant.Node=enchant.Class.create(enchant.EventTarget,{initialize:function(){enchant.EventTarget.call(this);this.age=this._offsetY=this._offsetX=this._y=this._x=0;this.animation=new Timeline(this);this.addEventListener("enterframe",
function(){this.animation.tick()});this.scene=this.parentNode=null;this.addEventListener("touchstart",function(a){this.parentNode&&this.parentNode!=this.scene&&this.parentNode.dispatchEvent(a)});this.addEventListener("touchmove",function(a){this.parentNode&&this.parentNode!=this.scene&&this.parentNode.dispatchEvent(a)});this.addEventListener("touchend",function(a){this.parentNode&&this.parentNode!=this.scene&&this.parentNode.dispatchEvent(a)})},moveTo:function(a,b){this._x=a;this._y=b;this._updateCoordinate()},
moveBy:function(a,b){this._x+=a;this._y+=b;this._updateCoordinate()},x:{get:function(){return this._x},set:function(a){this._x=a;this._updateCoordinate()}},y:{get:function(){return this._y},set:function(a){this._y=a;this._updateCoordinate()}},_updateCoordinate:function(){this.parentNode?(this._offsetX=this.parentNode._offsetX+this._x,this._offsetY=this.parentNode._offsetY+this._y):(this._offsetX=this._x,this._offsetY=this._y)},remove:function(){this._listener&&this.clearEventListener();this.parentNode&&
this.removeChild(this)}});enchant.Entity=enchant.Class.create(enchant.Node,{initialize:function(){enchant.Node.call(this);this._element=document.createElement("div");this._style=this._element.style;this._style.position="absolute";this._scaleY=this._scaleX=1;this._rotation=0;this._dirty=!1;this._transformOrigin="";this._height=this._width=0;this._backgroundColor=null;this._opacity=1;this._visible=!0;this._buttonMode=null;this.addEventListener("render",function(){if(this._dirty)this._style[f+"Transform"]=
["rotate(",this._rotation,"deg)scale(",this._scaleX,",",this._scaleY,")"].join(""),this._dirty=!1});if(enchant.Game.instance._debug)this._style.border="1px solid blue",this._style.margin="-1px";this.buttonMode=null;this.buttonPressed=!1;this.addEventListener("touchstart",function(){if(this.buttonMode){this.buttonPressed=!0;var a=new enchant.Event(this.buttonMode+"buttondown");this.dispatchEvent(a);e.dispatchEvent(a)}});this.addEventListener("touchend",function(){if(this.buttonMode){this.buttonPressed=
!1;var a=new enchant.Event(this.buttonMode+"buttonup");this.dispatchEvent(a);e.dispatchEvent(a)}});var a=this,b=function(){a.dispatchEvent(new enchant.Event("render"))};this.addEventListener("addedtoscene",function(){b();e.addEventListener("exitframe",b)});this.addEventListener("removedfromscene",function(){e.removeEventListener("exitframe",b)});this.addEventListener("render",function(){if(this._offsetX!=this._previousOffsetX)this._style.left=this._offsetX+"px";if(this._offsetY!=this._previousOffsetY)this._style.top=
this._offsetY+"px";this._previousOffsetX=this._offsetX;this._previousOffsetY=this._offsetY});a=this;m?(this._element.addEventListener("touchstart",function(b){for(var d=b.touches,g=0,e=d.length;g<e;g++)b=new enchant.Event("touchstart"),b.identifier=d[g].identifier,b._initPosition(d[g].pageX,d[g].pageY),a.dispatchEvent(b)},!1),this._element.addEventListener("touchmove",function(b){for(var d=b.touches,g=0,e=d.length;g<e;g++)b=new enchant.Event("touchmove"),b.identifier=d[g].identifier,b._initPosition(d[g].pageX,
d[g].pageY),a.dispatchEvent(b)},!1),this._element.addEventListener("touchend",function(b){for(var d=b.changedTouches,g=0,e=d.length;g<e;g++)b=new enchant.Event("touchend"),b.identifier=d[g].identifier,b._initPosition(d[g].pageX,d[g].pageY),a.dispatchEvent(b)},!1)):(this._element.addEventListener("mousedown",function(b){var d=b.pageX,g=b.pageY,b=new enchant.Event("touchstart");b.identifier=e._mousedownID;b._initPosition(d,g);a.dispatchEvent(b);a._mousedown=!0},!1),e._element.addEventListener("mousemove",
function(b){if(a._mousedown){var d=b.pageX,g=b.pageY,b=new enchant.Event("touchmove");b.identifier=e._mousedownID;b._initPosition(d,g);a.dispatchEvent(b)}},!1),e._element.addEventListener("mouseup",function(b){if(a._mousedown){var d=b.pageX,g=b.pageY,b=new enchant.Event("touchend");b.identifier=e._mousedownID;b._initPosition(d,g);a.dispatchEvent(b);a._mousedown=!1}},!1))},id:{get:function(){return this._element.id},set:function(a){this._element.id=a}},className:{get:function(){return this._element.className},
set:function(a){this._element.className=a}},width:{get:function(){return this._width},set:function(a){this._style.width=(this._width=a)+"px"}},height:{get:function(){return this._height},set:function(a){this._style.height=(this._height=a)+"px"}},transformOrigin:{get:function(){return this._transformOrigin},set:function(a){this._style[f+"TransformOrigin"]=this._transformOrigin=a}},scale:function(a,b){null==b&&(b=a);this._scaleX*=a;this._scaleY*=b;this._dirty=!0},rotate:function(a){this._rotation+=
a;this._dirty=!0},scaleX:{get:function(){return this._scaleX},set:function(a){this._scaleX=a;this._dirty=!0}},scaleY:{get:function(){return this._scaleY},set:function(a){this._scaleY=a;this._dirty=!0}},rotation:{get:function(){return this._rotation},set:function(a){this._rotation=a;this._dirty=!0}},backgroundColor:{get:function(){return this._backgroundColor},set:function(a){this._element.style.backgroundColor=this._backgroundColor=a}},opacity:{get:function(){return this._opacity},set:function(a){this._style.opacity=
this._opacity=a}},visible:{get:function(){return this._visible},set:function(a){this._style.display=(this._visible=a)?"block":"none"}},touchEnabled:{get:function(){return this._touchEnabled},set:function(a){this._style.pointerEvents=(this._touchEnabled=a)?"all":"none"}},intersect:function(a){return this.x<a.x+a.width&&a.x<this.x+this.width&&this.y<a.y+a.height&&a.y<this.y+this.height},within:function(a,b){null==b&&(b=(this.width+this.height+a.width+a.height)/4);var c;return(c=this.x-a.x+(this.width-
a.width)/2)*c+(c=this.y-a.y+(this.height-a.height)/2)*c<b*b}});enchant.Sprite=enchant.Class.create(enchant.Entity,{initialize:function(a,b){enchant.Entity.call(this);this.width=a;this.height=b;this._image=null;this._frame=0;this._style.overflow="hidden";if(enchant.Game.instance._debug)this._style.border="1px solid red",this._style.margin="-1px",this.addEventListener("touchstart",function(){enchant.Game.instance.running||console.log("touchstart",this)})},image:{get:function(){return this._image},set:function(a){if(a!=
this._image){if(null!=this._image)if(this._image.css)this._style.backgroundImage="";else if(this._element.firstChild)this._element.removeChild(this._element.firstChild),this._dirtyListener?(this.removeEventListener("render",this._dirtyListener),this._dirtyListener=null):this._image._parent=null;if(null!=a)if(a._css)this._style.backgroundImage=a._css;else if(a._parent){var b=document.createElement("canvas"),c=b.getContext("2d");b.width=a.width;b.height=a.height;c.drawImage(a._element,0,0);this._dirtyListener=
function(){if(a._dirty)c.drawImage(a._element),a._dirty=!1};this.addEventListener("render",this._dirtyListener);this._element.appendChild(b)}else a._parent=this,this._element.appendChild(a._element);this._image=a;this.frame=this.frame}}},frame:{get:function(){return this._frame},set:function(a){this._frame=a;if(null!=this._image){var b=this._image.width/this._width|0;if(this._image._css)this._style.backgroundPosition=[-(a%b)*this._width,"px ",-(a/b|0)*this._height,"px"].join("");else if(this._element.firstChild){var c=
this._element.firstChild.style;c.left=-(a%b)*this._width+"px";c.top=-(a/b|0)*this._height+"px"}}}}});enchant.Label=enchant.Class.create(enchant.Entity,{initialize:function(a){enchant.Entity.call(this);this.width=300;this.text=a},text:{get:function(){return this._element.innerHTML},set:function(a){this._element.innerHTML=a}},font:{get:function(){return this._style.font},set:function(a){this._style.font=a}},color:{get:function(){return this._style.color},set:function(a){this._style.color=a}}});enchant.Map=
enchant.Class.create(enchant.Entity,{initialize:function(a,b){enchant.Entity.call(this);var c=document.createElement("canvas");j&&2==e.scale?(c.width=2*e.width,c.height=2*e.height,this._style.webkitTransformOrigin="0 0",this._style.webkitTransform="scale(0.5)"):(c.width=e.width,c.height=e.height);this._element.appendChild(c);this._context=c.getContext("2d");this._tileWidth=a||0;this._tileHeight=b||0;this._image=null;this._data=[[[]]];this.touchEnabled=this._tight=this._dirty=!1;this.collisionData=
null;this._listeners.render=null;this.addEventListener("render",function(){if(this._dirty||null==this._previousOffsetX)this._dirty=!1,this.redraw(0,0,e.width,e.height);else if(this._offsetX!=this._previousOffsetX||this._offsetY!=this._previousOffsetY)if(this._tight){var a=-this._offsetX,b=-this._offsetY,c=-this._previousOffsetX,i=-this._previousOffsetY,n=a-c+e.width,k=c-a+e.width,l=b-i+e.height,f=i-b+e.height;if(n>this._tileWidth&&k>this._tileWidth&&l>this._tileHeight&&f>this._tileHeight){var j;n<
k?(j=0,a=c-a,k=n):(j=a-c,a=0);l<f?(n=0,b=i-b):(n=b-i,b=0,l=f);if(null==e._buffer)e._buffer=document.createElement("canvas"),e._buffer.width=this._context.canvas.width,e._buffer.height=this._context.canvas.height;f=e._buffer.getContext("2d");this._doubledImage?(f.clearRect(0,0,2*k,2*l),f.drawImage(this._context.canvas,2*j,2*n,2*k,2*l,0,0,2*k,2*l),f=this._context,f.clearRect(2*a,2*b,2*k,2*l),f.drawImage(e._buffer,0,0,2*k,2*l,2*a,2*b,2*k,2*l)):(f.clearRect(0,0,k,l),f.drawImage(this._context.canvas,j,
n,k,l,0,0,k,l),f=this._context,f.clearRect(a,b,k,l),f.drawImage(e._buffer,0,0,k,l,a,b,k,l));0==a?this.redraw(k,0,e.width-k,e.height):this.redraw(0,0,e.width-k,e.height);0==b?this.redraw(0,l,e.width,e.height-l):this.redraw(0,0,e.width,e.height-l)}else this.redraw(0,0,e.width,e.height)}else this.redraw(0,0,e.width,e.height);this._previousOffsetX=this._offsetX;this._previousOffsetY=this._offsetY})},loadData:function(a){this._data=Array.prototype.slice.apply(arguments);this._dirty=!0;this._tight=!1;for(var b=
0,c=this._data.length;b<c;b++){for(var d=0,a=this._data[b],g=0,e=a.length;g<e;g++)for(var i=0,f=a[g].length;i<f;i++)0<=a[g][i]&&d++;if(0.2<d/(a.length*a[0].length)){this._tight=!0;break}}},hitTest:function(a,b){if(0>a||this.width<=a||0>b||this.height<=b)return!1;var c=this._image.width,d=this._image.height,g=this._tileWidth||c,e=this._tileHeight||d,a=a/g|0,b=b/e|0;if(null!=this.collisionData)return this.collisionData[b]&&!!this.collisionData[b][a];for(var i=0,f=this._data.length;i<f;i++){var k=this._data[i],
l;if(null!=k[b]&&null!=(l=k[b][a])&&0<=l&&l<(c/g|0)*(d/e|0))return!0}return!1},image:{get:function(){return this._image},set:function(a){this._image=a;if(j&&2==e.scale){for(var b=new enchant.Surface(2*a.width,2*a.height),c=this._tileWidth||a.width,d=this._tileHeight||a.height,g=a.width/c|0,h=a.height/d|0,i=0;i<h;i++)for(var f=0;f<g;f++)b.draw(a,f*c,i*d,c,d,2*f*c,2*i*d,2*c,2*d);this._doubledImage=b}this._dirty=!0}},tileWidth:{get:function(){return this._tileWidth},set:function(a){this._tileWidth=a;
this._dirty=!0}},tileHeight:{get:function(){return this._tileHeight},set:function(a){this._tileHeight=a;this._dirty=!0}},width:{get:function(){return this._tileWidth*this._data[0][0].length}},height:{get:function(){return this._tileHeight*this._data[0].length}},redraw:function(a,b,c,d){if(null!=this._image){var g,e,i,f,k;this._doubledImage?(g=this._doubledImage,e=2*this._tileWidth,i=2*this._tileHeight,f=2*-this._offsetX,k=2*-this._offsetY,a*=2,b*=2,c*=2,d*=2):(g=this._image,e=this._tileWidth,i=this._tileHeight,
f=-this._offsetX,k=-this._offsetY);var l=g.width/e|0,j=g.height/i|0,m=Math.max((a+f)/e|0,0),o=Math.max((b+k)/i|0,0),t=Math.ceil((a+f+c)/e),q=Math.ceil((b+k+d)/i);g=g._element;var s=this._context;s.clearRect(a,b,c,d);c=0;for(d=this._data.length;c<d;c++)for(var r=this._data[c],u=Math.min(t,r[0].length),v=Math.min(q,r.length),b=o;b<v;b++)for(a=m;a<u;a++){var p=r[b][a];0<=p&&p<l*j&&s.drawImage(g,p%l*e,(p/l|0)*i,e,i,a*e-f,b*i-k,e,i)}}}});enchant.Group=enchant.Class.create(enchant.Node,{initialize:function(){enchant.Node.call(this);
this.childNodes=[];this._y=this._x=0},addChild:function(a){this.childNodes.push(a);a.parentNode=this;a.dispatchEvent(new enchant.Event("added"));if(this.scene){var b=new enchant.Event("addedtoscene");a.scene=this.scene;a.dispatchEvent(b);a._updateCoordinate();var c=document.createDocumentFragment(),d,e=Array.prototype.push;if(a._element)c.appendChild(a._element);else if(a.childNodes)for(d=a.childNodes.slice().reverse();d.length;)a=d.pop(),a.scene=this.scene,a.dispatchEvent(b),a._element?c.appendChild(a._element):
a.childNodes&&e.apply(d,a.childNodes.reverse());if(c.childNodes.length){for(var h,b=this;b.parentNode;){d=b.parentNode.childNodes;for(d=d.slice(d.indexOf(b)+1).reverse();d.length;)if(a=d.pop(),a._element){h=a._element;break}else a.childNodes&&e.apply(d,a.childNodes.slice().reverse());b=b.parentNode}h?this.scene._element.insertBefore(c,h):this.scene._element.appendChild(c)}}},insertBefore:function(a,b){var c=this.childNodes.indexOf(b);if(-1!=c){if(this.childNodes.splice(c,0,a),a.parentNode=this,a.dispatchEvent(new enchant.Event("added")),
this.scene){var d=new enchant.Event("addedtoscene");a.scene=this.scene;a.dispatchEvent(d);a._updateCoordinate();var e=document.createDocumentFragment(),h,f=Array.prototype.push;if(a._element)e.appendChild(a._element);else if(a.childNodes)for(h=a.childNodes.slice().reverse();h.length;)a=h.pop(),a.scene=this.scene,a.dispatchEvent(d),a._element?e.appendChild(a._element):a.childNodes&&f.apply(h,a.childNodes.reverse());if(e.childNodes.length){for(var j,d=b;d.parentNode;){null!=c?(h=this.childNodes.slice(c+
1).reverse(),c=null):(h=d.parentNode.childNodes,h=h.slice(h.indexOf(d)+1).reverse());for(;h.length;)if(a=h.pop(),a._element){j=a._element;break}else a.childNodes&&f.apply(h,a.childNodes.slice().reverse());d=d.parentNode}j?this.scene._element.insertBefore(e,j):this.scene._element.appendChild(e)}}}else this.addChild(a)},removeChild:function(a){var b=this.childNodes.indexOf(a);if(-1!=b&&(this.childNodes.splice(b,1),a.parentNode=null,a.dispatchEvent(new enchant.Event("removed")),this.scene))if(b=new enchant.Event("removedfromscene"),
a.scene=null,a.dispatchEvent(b),a._element)this.scene._element.removeChild(a._element);else if(a.childNodes)for(var c=a.childNodes.slice(),d=Array.prototype.push;c.length;)a=c.pop(),a.scene=null,a.dispatchEvent(b),a._element?this.scene._element.removeChild(a._element):a.childNodes&&d.apply(c,a.childNodes)},firstChild:{get:function(){return this.childNodes[0]}},lastChild:{get:function(){return this.childNodes[this.childNodes.length-1]}},_updateCoordinate:function(){this.parentNode?(this._offsetX=this.parentNode._offsetX+
this._x,this._offsetY=this.parentNode._offsetY+this._y):(this._offsetX=this._x,this._offsetY=this._y);for(var a=0,b=this.childNodes.length;a<b;a++)this.childNodes[a]._updateCoordinate()}});enchant.RGroup=enchant.Class.create(enchant.Group,{initialize:function(a,b){enchant.Group.call(this);if(2>arguments.length)throw"Width and height of RGroup must be specified";this.width=a;this.height=b;this.rotationOrigin={x:a/2,y:b/2};console.log(this.x,this.y,this.rotationOrigin.x,this.rotationOrigin.y);this._rotation=
0},addChild:function(a){console.log(a);enchant.Group.prototype.addChild.apply(this,arguments);a.transformOrigin="0 0"},rotation:{get:function(){return this._rotation},set:function(a){var b=a-this._rotation;if(0!=b){var c=b/180*Math.PI,d=Math.sin(c),e=Math.cos(c),h={x:this.width/2,y:this.height/2};console.log("diff_rotation",b,"rad",c);console.log("origin",h.x,h.y);console.log("sin",d,"cos",e);for(var c=0,f=this.childNodes.length;c<f;c++){var j=this.childNodes[c];j.rotation-=b;var k=j.x-h.x,l=j.y-
h.y;console.log(h.x,h.y,e,d,h,k,l,j.x,j.y);j.x=+e*k+d*l+h.x;j.y=-d*k+e*l+h.y}this._rotation=a}}}});enchant.Scene=enchant.Class.create(enchant.Group,{initialize:function(){enchant.Group.call(this);this._element=document.createElement("div");this._element.style.position="absolute";this._element.style.overflow="hidden";this._element.style.width=(this.width=e.width)+"px";this._element.style.height=(this.height=e.height)+"px";this._element.style[f+"TransformOrigin"]="0 0";this._element.style[f+"Transform"]=
"scale("+e.scale+")";this.scene=this;var a=this;m?(this._element.addEventListener("touchstart",function(b){for(var c=b.touches,d=0,e=c.length;d<e;d++)b=new enchant.Event("touchstart"),b.identifier=c[d].identifier,b._initPosition(c[d].pageX,c[d].pageY),a.dispatchEvent(b)},!1),this._element.addEventListener("touchmove",function(b){for(var c=b.touches,d=0,e=c.length;d<e;d++)b=new enchant.Event("touchmove"),b.identifier=c[d].identifier,b._initPosition(c[d].pageX,c[d].pageY),a.dispatchEvent(b)},!1),this._element.addEventListener("touchend",
function(b){for(var c=b.changedTouches,d=0,e=c.length;d<e;d++)b=new enchant.Event("touchend"),b.identifier=c[d].identifier,b._initPosition(c[d].pageX,c[d].pageY),a.dispatchEvent(b)},!1)):(this._element.addEventListener("mousedown",function(b){var c=b.pageX,d=b.pageY,b=new enchant.Event("touchstart");b.identifier=e._mousedownID;b._initPosition(c,d);a.dispatchEvent(b);a._mousedown=!0},!1),e._element.addEventListener("mousemove",function(b){if(a._mousedown){var c=b.pageX,d=b.pageY,b=new enchant.Event("touchmove");
b.identifier=e._mousedownID;b._initPosition(c,d);a.dispatchEvent(b)}},!1),e._element.addEventListener("mouseup",function(b){if(a._mousedown){var c=b.pageX,d=b.pageY,b=new enchant.Event("touchend");b.identifier=e._mousedownID;b._initPosition(c,d);a.dispatchEvent(b);a._mousedown=!1}},!1))},backgroundColor:{get:function(){return this._backgroundColor},set:function(a){this._element.style.backgroundColor=this._backgroundColor=a}},_updateCoordinate:function(){this._offsetX=this._x;this._offsetY=this._y;
for(var a=0,b=this.childNodes.length;a<b;a++)this.childNodes[a]._updateCoordinate()}});var o="putImageData,drawImage,drawFocusRing,fill,stroke,clearRect,fillRect,strokeRect,fillText,strokeText".split(",");enchant.Surface=enchant.Class.create(enchant.EventTarget,{initialize:function(a,b){enchant.EventTarget.call(this);this.width=a;this.height=b;this.context=null;var c="enchant-surface"+e._surfaceID++;document.getCSSCanvasContext?(this.context=document.getCSSCanvasContext("2d",c,a,b),this._element=
this.context.canvas,this._css="-webkit-canvas("+c+")"):document.mozSetImageElement?(this._element=document.createElement("canvas"),this._element.width=a,this._element.height=b,this._css="-moz-element(#"+c+")",this.context=this._element.getContext("2d"),document.mozSetImageElement(c,this._element)):(this._element=document.createElement("canvas"),this._element.width=a,this._element.height=b,this._element.style.position="absolute",this.context=this._element.getContext("2d"),o.forEach(function(a){var b=
this.context[a];this.context[a]=function(){b.apply(this,arguments);this._dirty=!0}},this))},getPixel:function(a,b){return this.context.getImageData(a,b,1,1).data},setPixel:function(a,b,c,d,e,h){var f=this.context.createImageData(1,1);f.data[0]=c;f.data[1]=d;f.data[2]=e;f.data[3]=h;this.context.putImageData(f,a,b,1,1)},clear:function(){this.context.clearRect(0,0,this.width,this.height)},draw:function(a){arguments[0]=a=a._element;1==arguments.length?this.context.drawImage(a,0,0):this.context.drawImage.apply(this.context,
arguments)},clone:function(){var a=new enchant.Surface(this.width,this.height);a.draw(this);return a},toDataURL:function(){var a=this._element.src;return a?"data:"==a.slice(0,5)?a:this.clone().toDataURL():this._element.toDataURL()}});enchant.Surface.load=function(a){var b=new Image,c=Object.create(Surface.prototype,{context:{value:null},_css:{value:"url("+a+")"},_element:{value:b}});enchant.EventTarget.call(c);b.src=a;b.onerror=function(){throw Error("Cannot load an asset: "+b.src);};b.onload=function(){c.width=
b.width;c.height=b.height;c.dispatchEvent(new enchant.Event("load"))};return c};enchant.Sound=enchant.Class.create(enchant.EventTarget,{initialize:function(){enchant.EventTarget.call(this);throw Error("Illegal Constructor");},play:function(){this._element&&this._element.play()},pause:function(){this._element&&this._element.pause()},stop:function(){this.pause();this.currentTime=0},clone:function(){var a;a=this._element instanceof Audio?Object.create(enchant.Sound.prototype,{_element:{value:this._element.cloneNode(!1)},
duration:{value:this.duration}}):Object.create(enchant.Sound.prototype);enchant.EventTarget.call(a);return a},currentTime:{get:function(){return this._element?this._element.currentTime:0},set:function(a){if(this._element)this._element.currentTime=a}},volume:{get:function(){return this._element?this._element.volume:1},set:function(a){if(this._element)this._element.volume=a}}});enchant.Sound.load=function(a,b){if(null==b)var c=a.match(/\.\w+$/)[0],b=c?"audio/"+c.slice(1).toLowerCase():"";var b=b.replace("mp3",
"mpeg"),d=Object.create(enchant.Sound.prototype);enchant.EventTarget.call(d);var g=new Audio;if(!enchant.Sound.enabledInMobileSafari&&"webkit"==f&&m)window.setTimeout(function(){d.dispatchEvent(new enchant.Event("load"))},0);else if(g.canPlayType(b))g.src=a,g.load(),g.autoplay=!1,g.onerror=function(){throw Error("Cannot load an asset: "+g.src);},g.addEventListener("canplaythrough",function(){d.duration=g.duration;d.dispatchEvent(new enchant.Event("load"))},!1),d._element=g;else if("audio/mpeg"==b){var h=
document.createElement("embed"),c="enchant-audio"+e._soundID++;h.width=h.height=1;h.name=c;h.src="sound.swf?id="+c+"&src="+a;h.allowscriptaccess="always";h.style.position="absolute";h.style.left="-1px";d.addEventListener("load",function(){Object.defineProperties(h,{currentTime:{get:function(){return h.getCurrentTime()},set:function(a){h.setCurrentTime(a)}},volume:{get:function(){return h.getVolume()},set:function(a){h.setVolume(a)}}});d._element=h;d.duration=h.getDuration()});e._element.appendChild(h);
enchant.Sound[c]=d}else window.setTimeout(function(){d.dispatchEvent(new enchant.Event("load"))},0);return d};enchant.Sound.enabledInMobileSafari=!1;enchant.Action=enchant.Class.create({initialize:function(a,b){this.timeline=a;this.node=a.node;this.time=this.frame=0;this.callback=this.func=null;this.loaded=!1;this.onload=null;if(b)for(var c in b)this[c]=b[c]},tick:function(){if(!this.loaded)this.onload&&this.onload.call(this),this.loaded=!0;this.func&&this.func();this.frame++;if(this.time<this.frame){if(this.callback)return this.callback(),
!1}else return!0},reset:function(){this.frame=0;this.loaded=!1}});enchant.Tween=enchant.Class.create(enchant.Action,{initialize:function(a,b){this._origin={};this._target={};enchant.Action.call(this,a,b);if("undefined"===typeof this.easing)this.easing=function(a,b,e,f){return e*a/f+b};if(null==this.onload)this.onload=function(){var c=["frame","time","callback","onload"],d;for(d in b)-1==c.indexOf(d)&&(this._origin[d]=a[d],this._target[d]=b[d])};this.node=a;this.func=function(){for(var a in this._target)if("undefined"!==
typeof this.node[a]){var b=this.easing(this.frame,0,1,this.time),b=this._target[a]*b+this._origin[a]*(1-b);this.node[a]="x"===a||"y"===a?Math.round(b):b}}}});enchant.Timeline=enchant.Class.create({initialize:function(a){this.queue=[];this.node=a;this.looped=this.paused=!1},tick:function(){if(!this.paused&&0!=this.queue.length&&!this.queue[0].tick()){if(this.looped){var a=this.queue.shift();a.reset();this.queue.push(a)}else this.queue.shift();this.tick()}},pushTween:function(a,b){var c=new Tween(this.node,
a);if(void 0!==b)c.time=b;this.queue.push(c);return this},pushAction:function(a,b){var c=new Action(this,a);if(void 0!==b)tween.time=b;this.queue.push(c);return this},fadeTo:function(a,b,c){if(2>arguments.length)b=enchant.Game.fps;if(3>arguments.length)c=enchant.Easing.LINEAR;this.pushTween({time:b,opacity:a,easing:c});return this},fadeIn:function(a,b){if(void 0===a)a=enchant.Game.instance.fps;if(void 0===b)b=enchant.Easing.LINEAR;this.fadeTo(1,a,b);return this},fadeOut:function(a,b){if(void 0===
a)a=enchant.Game.instance.fps;if(void 0===b)b=enchant.Easing.LINEAR;this.fadeTo(0,a,b);return this},hide:function(){this.pushAction({time:0,callback:function(){this.node.opacity=0}});return this},show:function(){this.pushAction({time:0,callback:function(){this.opacity=0}})},scaleTo:function(a,b,c){if(2>arguments.length)b=enchant.Game.fps;if(3>arguments.length)c=enchant.Easing.LINEAR;this.pushTween({time:b,scaleX:a,scaleY:a,easing:c});return this},scaleBy:function(a,b,c){if(void 0===b)b=enchant.Game.instance.fps;
if(void 0===c)c=enchant.Easing.LINEAR;this.pushTween({time:b,onload:function(){this._origin.scaleX=this.node.scaleX;this._target.scaleX=this.node.scaleX*a;this._origin.scaleY=this.node.scaleY;this._target.scaleY=this.node.scaleY*a},scale:a,easing:c});return this},rotateTo:function(a,b,c){if(void 0===b)b=enchant.Game.instance.fps;if(void 0===c)c=enchant.Easing.LINEAR;this.pushTween({time:b,rotation:a,easing:c});return this},rotateBy:function(a,b,c){if(void 0===b)b=enchant.Game.instance.fps;if(void 0===
c)c=enchant.Easing.LINEAR;this.pushTween({time:b,onload:function(){this._origin.rotation=this.node.rotation;this._target.rotation=this.node.rotation+a},rotation:a,easing:c});return this},moveTo:function(a,b,c,d){if(void 0===c)c=enchant.Game.instance.fps;if(void 0===d)d=enchant.Easing.LINEAR;this.pushTween({time:c,x:a,y:b,easing:d});return this},moveBy:function(a,b,c,d){if(void 0===c)c=enchant.Game.instance.fps;if(void 0===d)d=enchant.Easing.LINEAR;this.pushTween({time:c,onload:function(){this._origin.x=
this.node.x;this._origin.y=this.node.y;this._target.x=this.node.x+a;this._target.y=this.node.y+b},easing:d});return this},delay:function(a){this.pushAction({time:a});return this},then:function(a){this.pushAction({time:0,callback:a});return this},after:function(a){this.pushAction({tick:function(){return!a()}});return this},repeat:function(a,b,c){void 0===c&&(c=1);this.pushAction({func:function(){0==this.frame%c&&a()},time:b});return this},loop:function(){return this},jumpTo:function(a,b){var c=this.node;
return this.then(function(){c.x=a;c.y=b})},jumpBy:function(a,b){var c=this.node;return this.then(function(){c.x+=a;c.y+=b})},pause:function(){this.paused=!0;return this},start:function(){this.paused=!1;return this},clear:function(){this.queue=[];this.paused=!1;return this}});enchant.Easing={LINEAR:function(a,b,c,d){return c*a/d+b},QUAD_EASEIN:function(a,b,c,d){return c*(a/=d)*a+b},QUAD_EASEOUT:function(a,b,c,d){return-c*(a/=d)*(a-2)+b},QUAD_EASEINOUT:function(a,b,c,d){return 1>(a/=d/2)?c/2*a*a+b:
-c/2*(--a*(a-2)-1)+b},QUBIC_EASEIN:function(a,b,c,d){return c*(a/=d)*a*a+b},QUBIC_EASEOUT:function(a,b,c,d){return c*((a=a/d-1)*a*a+1)+b},QUBIC_EASEINOUT:function(a,b,c,d){return 1>(a/=d/2)?c/2*a*a*a+b:c/2*((a-=2)*a*a+2)+b},QUART_EASEIN:function(a,b,c,d){return c*(a/=d)*a*a*a+b},QUART_EASEOUT:function(a,b,c,d){return-c*((a=a/d-1)*a*a*a-1)+b},QUART_EASEINOUT:function(a,b,c,d){return 1>(a/=d/2)?c/2*a*a*a*a+b:-c/2*((a-=2)*a*a*a-2)+b},QUINT_EASEIN:function(a,b,c,d){return c*(a/=d)*a*a*a*a+b},QUINT_EASEOUT:function(a,
b,c,d){return c*((a=a/d-1)*a*a*a*a+1)+b},QUINT_EASEINOUT:function(a,b,c,d){return 1>(a/=d/2)?c/2*a*a*a*a*a+b:c/2*((a-=2)*a*a*a*a+2)+b},SIN_EASEIN:function(a,b,c,d){return-c*Math.cos(a/d*(Math.PI/2))+c+b},SIN_EASEOUT:function(a,b,c,d){return c*Math.sin(a/d*(Math.PI/2))+b},SIN_EASEINOUT:function(a,b,c,d){return-c/2*(Math.cos(Math.PI*a/d)-1)+b},CIRC_EASEIN:function(a,b,c,d){return-c*(Math.sqrt(1-(a/=d)*a)-1)+b},CIRC_EASEOUT:function(a,b,c,d){return c*Math.sqrt(1-(a=a/d-1)*a)+b},CIRC_EASEINOUT:function(a,
b,c,d){return 1>(a/=d/2)?-c/2*(Math.sqrt(1-a*a)-1)+b:c/2*(Math.sqrt(1-(a-=2)*a)+1)+b},ELASTIC_EASEIN:function(a,b,c,d,e,f){if(0==a)return b;if(1==(a/=d))return b+c;f||(f=0.3*d);!e||e<Math.abs(c)?(e=c,c=f/4):c=f/(2*Math.PI)*Math.asin(c/e);return-(e*Math.pow(2,10*(a-=1))*Math.sin((a*d-c)*2*Math.PI/f))+b},ELASTIC_EASEOUT:function(a,b,c,d,e,f){if(0==a)return b;if(1==(a/=d))return b+c;f||(f=0.3*d);if(!e||e<Math.abs(c))var e=c,i=f/4;else i=f/(2*Math.PI)*Math.asin(c/e);return e*Math.pow(2,-10*a)*Math.sin((a*
d-i)*2*Math.PI/f)+c+b},ELASTIC_EASEINOUT:function(a,b,c,d,e,f){if(0==a)return b;if(2==(a/=d/2))return b+c;f||(f=d*0.3*1.5);if(!e||e<Math.abs(c))var e=c,i=f/4;else i=f/(2*Math.PI)*Math.asin(c/e);return 1>a?-0.5*e*Math.pow(2,10*(a-=1))*Math.sin((a*d-i)*2*Math.PI/f)+b:0.5*e*Math.pow(2,-10*(a-=1))*Math.sin((a*d-i)*2*Math.PI/f)+c+b},BOUNCE_EASEOUT:function(a,b,c,d){return(a/=d)<1/2.75?c*7.5625*a*a+b:a<2/2.75?c*(7.5625*(a-=1.5/2.75)*a+0.75)+b:a<2.5/2.75?c*(7.5625*(a-=2.25/2.75)*a+0.9375)+b:c*(7.5625*(a-=
2.625/2.75)*a+0.984375)+b},BOUNCE_EASEIN:function(a,b,c,d){return c-enchant.Easing.BOUNCE_EASEOUT(d-a,0,c,d)+b},BOUNCE_EASEINOUT:function(a,b,c,d){return a<d/2?0.5*enchant.Easing.BOUNCE_EASEIN(2*a,0,c,d)+b:0.5*enchant.Easing.BOUNCE_EASEOUT(2*a-d,0,c,d)+0.5*c+b},BACK_EASEIN:function(a,b,c,d,e){void 0==e&&(e=1.70158);return c*(a/=d)*a*((e+1)*a-e)+b},BACK_EASEOUT:function(a,b,c,d,e){void 0==e&&(e=1.70158);return c*((a=a/d-1)*a*((e+1)*a+e)+1)+b},BACK_EASEINOUT:function(a,b,c,d,e){void 0==e&&(e=1.70158);
return 1>(a/=d/2)?c/2*a*a*(((e*=1.525)+1)*a-e)+b:c/2*((a-=2)*a*(((e*=1.525)+1)*a+e)+2)+b},EXPO_EASEIN:function(a,b,c,d){return 0==a?b:c*Math.pow(2,10*(a/d-1))+b},EXPO_EASEOUT:function(a,b,c,d){return a==d?b+c:c*(-Math.pow(2,-10*a/d)+1)+b},EXPO_EASEINOUT:function(a,b,c,d){return 0==a?b:a==d?b+c:1>(a/=d/2)?c/2*Math.pow(2,10*(a-1))+b:c/2*(-Math.pow(2,-10*--a)+2)+b}};window.addEventListener("message",function(a){a=JSON.parse(a.data);if("event"==a.type)e.dispatchEvent(new Event(a.value));else if("debug"==
a.type)switch(a.value){case "start":enchant.Game.instance.start();break;case "pause":enchant.Game.instance.pause();break;case "resume":enchant.Game.instance.resume();break;case "tick":enchant.Game.instance._tick()}})})();
=======
if("function"!=typeof Object.defineProperty)Object.defineProperty=function(g,l,f){if("value"in f)g[l]=f.value;"get"in f&&g.__defineGetter__(l,f.get);"set"in f&&g.__defineSetter__(l,f.set);return g};if("function"!=typeof Object.defineProperties)Object.defineProperties=function(g,l){for(var f in l)l.hasOwnProperty(f)&&Object.defineProperty(g,f,l[f]);return g};
if("function"!=typeof Object.create)Object.create=function(g,l){function f(){}f.prototype=g;var c=new f;null!=l&&Object.defineProperties(c,l);return c};if("function"!=typeof Object.getPrototypeOf)Object.getPrototypeOf=function(g){return g.__proto__};
var enchant=function(g){null!=g&&(g instanceof Array||(g=Array.prototype.slice.call(arguments)),g=g.filter(function(g){return""+g}));(function f(c,n){var a=[],b;for(b in c)c.hasOwnProperty(b)&&("function"==typeof c[b]?window[b]=c[b]:Object.getPrototypeOf(c[b])==Object.prototype&&(null==g?a.push(b):(e=g.indexOf(n+b),-1!=e&&(a.push(b),g.splice(e,1)))));var e=0;for(b=a.length;e<b;e++)f(c[a[e]],n+a[e]+".")})(enchant,"");if(null!=g&&g.length)throw Error("Cannot load module: "+g.join(", "));};
(function(){var g=function(){var a=navigator.userAgent;return-1!=a.indexOf("Opera")?"O":-1!=a.indexOf("MSIE")?"ms":-1!=a.indexOf("WebKit")?"webkit":"Gecko"==navigator.product?"Moz":""}(),l=function(){var a=document.createElement("div");a.setAttribute("ontouchstart","return");return"function"==typeof a.ontouchstart}(),f=function(){if(-1!=navigator.userAgent.indexOf("iPhone")&&2==window.devicePixelRatio){var a=document.querySelector('meta[name="viewport"]');null==a&&(a=document.createElement("meta"),
document.head.appendChild(a));a.setAttribute("content","width=640px");return!0}return!1}(),c;enchant.Class=function(a,b){return enchant.Class.create(a,b)};enchant.Class.create=function(a,b){if(0==arguments.length)return enchant.Class.create(Object,b);if(1==arguments.length&&"function"!=typeof arguments[0])return enchant.Class.create(Object,arguments[0]);for(var e in b)if(b.hasOwnProperty(e))if(Object.getPrototypeOf(b[e])==Object.prototype){if(!("enumerable"in b[e]))b[e].enumerable=!0}else b[e]={value:b[e],
enumerable:!0,writable:!0};var d=function(){if(this instanceof d)d.prototype.initialize.apply(this,arguments);else return new d};d.prototype=Object.create(a.prototype,b);d.prototype.constructor=d;if(null==d.prototype.initialize)d.prototype.initialize=function(){a.apply(this,arguments)};return d};enchant.Event=enchant.Class.create({initialize:function(a){this.type=a;this.target=null;this.localY=this.localX=this.y=this.x=0},_initPosition:function(a,b){this.x=this.localX=(a-c._pageX)/c.scale;this.y=
this.localY=(b-c._pageY)/c.scale}});enchant.Event.LOAD="load";enchant.Event.PROGRESS="progress";enchant.Event.ENTER_FRAME="enterframe";enchant.Event.EXIT_FRAME="exitframe";enchant.Event.ENTER="enter";enchant.Event.EXIT="exit";enchant.Event.ADDED="added";enchant.Event.ADDED_TO_SCENE="addedtoscene";enchant.Event.REMOVED="removed";enchant.Event.REMOVED_FROM_SCENE="removedfromscene";enchant.Event.TOUCH_START="touchstart";enchant.Event.TOUCH_MOVE="touchmove";enchant.Event.TOUCH_END="touchend";enchant.Event.RENDER=
"render";enchant.Event.INPUT_START="inputstart";enchant.Event.INPUT_CHANGE="inputchange";enchant.Event.INPUT_END="inputend";enchant.Event.LEFT_BUTTON_DOWN="leftbuttondown";enchant.Event.LEFT_BUTTON_UP="leftbuttonup";enchant.Event.RIGHT_BUTTON_DOWN="rightbuttondown";enchant.Event.RIGHT_BUTTON_UP="rightbuttonup";enchant.Event.UP_BUTTON_DOWN="upbuttondown";enchant.Event.UP_BUTTON_UP="upbuttonup";enchant.Event.DOWN_BUTTON_DOWN="downbuttondown";enchant.Event.DOWN_BUTTON_UP="downbuttonup";enchant.Event.A_BUTTON_DOWN=
"abuttondown";enchant.Event.A_BUTTON_UP="abuttonup";enchant.Event.B_BUTTON_DOWN="bbuttondown";enchant.Event.B_BUTTON_UP="bbuttonup";enchant.EventTarget=enchant.Class.create({initialize:function(){this._listeners={}},addEventListener:function(a,b){var e=this._listeners[a];null==e?this._listeners[a]=[b]:-1==e.indexOf(b)&&e.unshift(b)},removeEventListener:function(a,b){var e=this._listeners[a];if(null!=e){var d=e.indexOf(b);-1!=d&&e.splice(d,1)}},clearEventListener:function(a){null!=a?delete this._listeners[a]:
this._listeners={}},dispatchEvent:function(a){a.target=this;a.localX=a.x-this._offsetX;a.localY=a.y-this._offsetY;if(null!=this["on"+a.type])this["on"+a.type]();var b=this._listeners[a.type];if(null!=b)for(var b=b.slice(),e=0,d=b.length;e<d;e++)b[e].call(this,a)}});enchant.Game=enchant.Class.create(enchant.EventTarget,{initialize:function(a,b){enchant.EventTarget.call(this);var e=!0;c&&(e=!1,c.stop());c=enchant.Game.instance=this;this.width=a||320;this.height=b||320;this.scale=1;var d=document.getElementById("enchant-stage");
if(d){var m=window.getComputedStyle(d),a=parseInt(m.width),b=parseInt(m.height);a&&b?this.scale=Math.min(a/this.width,b/this.height):(d.style.width=this.width+"px",d.style.height=this.height+"px");for(;d.firstChild;)d.removeChild(d.firstChild);d.style.position="relative";m=d.getBoundingClientRect();this._pageX=Math.round(window.scrollX+m.left);this._pageY=Math.round(window.scrollY+m.top)}else d=document.createElement("div"),d.id="enchant-stage",d.style.width=window.innerWidth+"px",d.style.height=
window.innerHeight+"px",d.style.position="absolute",document.body.firstChild?document.body.insertBefore(d,document.body.firstChild):document.body.appendChild(d),this.scale=Math.min(window.innerWidth/this.width,window.innerHeight/this.height),this._pageY=this._pageX=0;if(!this.scale)this.scale=1;d.style.fontSize="12px";d.style.webkitTextSizeAdjust="none";this._element=d;this.fps=30;this.frame=0;this.ready=null;this.running=!1;this.assets={};var h=this._assets=[];(function q(a){a.assets instanceof Array&&
[].push.apply(h,a.assets);for(var b in a)a.hasOwnProperty(b)&&Object.getPrototypeOf(a[b])==Object.prototype&&q(a[b])})(enchant);this._scenes=[];this.currentScene=null;this.rootScene=new enchant.Scene;this.pushScene(this.rootScene);this.loadingScene=new enchant.Scene;this.loadingScene.backgroundColor="#000";var i=0.9*this.width|0,o=0.3*this.width|0,k=0.05*i|0,d=new enchant.Sprite(i,o);d.x=(this.width-i)/2;d.y=(this.height-o)/2;var j=new enchant.Surface(i,o);j.context.fillStyle="#fff";j.context.fillRect(0,
0,i,o);j.context.fillStyle="#000";j.context.fillRect(k,k,i-2*k,o-2*k);d.image=j;var g=0,f=0;this.addEventListener("progress",function(a){g=a.loaded/a.total});d.addEventListener("enterframe",function(){f*=0.9;f+=0.1*g;j.context.fillStyle="#fff";j.context.fillRect(k,0,(i-2*k)*f,o)});this.loadingScene.addChild(d);this._soundID=this._surfaceID=this._mousedownID=0;this._intervalID=null;this.input={};this._keybind={};this.keybind(37,"left");this.keybind(38,"up");this.keybind(39,"right");this.keybind(40,
"down");var n=0;"left,right,up,down,a,b".split(",").forEach(function(a){this.addEventListener(a+"buttondown",function(b){this.input[a]||(this.input[a]=!0,this.dispatchEvent(new enchant.Event(n++?"inputchange":"inputstart")));this.currentScene.dispatchEvent(b)});this.addEventListener(a+"buttonup",function(b){this.input[a]&&(this.input[a]=!1,this.dispatchEvent(new enchant.Event(--n?"inputchange":"inputend")));this.currentScene.dispatchEvent(b)})},this);e&&(document.addEventListener("keydown",function(a){c.dispatchEvent(new enchant.Event("keydown"));
if(37<=a.keyCode&&40>=a.keyCode||32==a.keyCode)a.preventDefault(),a.stopPropagation();if(c.running&&(a=c._keybind[a.keyCode]))a=new enchant.Event(a+"buttondown"),c.dispatchEvent(a)},!0),document.addEventListener("keyup",function(a){if(c.running&&(a=c._keybind[a.keyCode]))a=new enchant.Event(a+"buttonup"),c.dispatchEvent(a)},!0),l?(document.addEventListener("touchstart",function(a){a.preventDefault()},!0),document.addEventListener("touchmove",function(a){a.preventDefault();c.running||a.stopPropagation()},
!0),document.addEventListener("touchend",function(a){a.preventDefault();c.running||a.stopPropagation()},!0)):(document.addEventListener("mousedown",function(a){a.preventDefault();c._mousedownID++;c.running||a.stopPropagation()},!0),document.addEventListener("mousemove",function(a){a.preventDefault();c.running||a.stopPropagation()},!0),document.addEventListener("mouseup",function(a){a.preventDefault();c.running||a.stopPropagation()},!0)))},preload:function(a){a instanceof Array||(a=Array.prototype.slice.call(arguments));
[].push.apply(this._assets,a)},load:function(a,b){null==b&&(b=function(){});var e=a.match(/\.\w+$/)[0];e&&(e=e.slice(1).toLowerCase());switch(e){case "jpg":case "gif":case "png":c.assets[a]=enchant.Surface.load(a);c.assets[a].addEventListener("load",b);break;case "mp3":case "aac":case "m4a":case "wav":case "ogg":c.assets[a]=enchant.Sound.load(a,"audio/"+e);c.assets[a].addEventListener("load",b);break;default:var d=new XMLHttpRequest;d.open("GET",a,!0);d.onreadystatechange=function(){if(4==d.readyState){if(200!=
d.status&&0!=d.status)throw Error(d.status+": Cannot load an asset: "+a);var e=d.getResponseHeader("Content-Type")||"";e.match(/^image/)?(c.assets[a]=enchant.Surface.load(a),c.assets[a].addEventListener("load",b)):e.match(/^audio/)?(c.assets[a]=enchant.Sound.load(a,e),c.assets[a].addEventListener("load",b)):(c.assets[a]=d.responseText,b())}};d.send(null)}},start:function(){if(this._intervalID)window.clearInterval(this._intervalID);else if(this._assets.length){if(enchant.Sound.enabledInMobileSafari&&
!c._touched&&"webkit"==g&&l){var a=new enchant.Scene;a.backgroundColor="#000";var b=Math.round(c.width/10),e=new enchant.Sprite(c.width,b);e.y=(c.height-b)/2;e.image=new enchant.Surface(c.width,b);e.image.context.fillStyle="#fff";e.image.context.font=b-1+"px bold Helvetica,Arial,sans-serif";var d=e.image.context.measureText("Touch to Start").width;e.image.context.fillText("Touch to Start",(c.width-d)/2,b-1);a.addChild(e);document.addEventListener("touchstart",function(){c._touched=!0;c.removeScene(a);
c.start()},!0);c.pushScene(a);return}var m={},b=this._assets.filter(function(a){return a in m?!1:m[a]=!0}),h=0,e=0,i=b.length;for(;e<i;e++)this.load(b[e],function(){var a=new enchant.Event("progress");a.loaded=++h;a.total=i;c.dispatchEvent(a);h==i&&(c.removeScene(c.loadingScene),c.dispatchEvent(new enchant.Event("load")))});this.pushScene(this.loadingScene)}else this.dispatchEvent(new enchant.Event("load"));this.currentTime=Date.now();this._intervalID=window.setInterval(function(){c._tick()},1E3/
this.fps);this.running=!0},debug:function(){this._debug=!0;this.rootScene.addEventListener("enterframe",function(a){this._actualFps=1/a});this.start()},actualFps:{get:function(){return this._actualFps||this.fps}},_tick:function(){var a=Date.now(),b=new enchant.Event("enterframe");b.elapsed=a-this.currentTime;this.currentTime=a;for(var a=this.currentScene.childNodes.slice(),e=Array.prototype.push;a.length;){var d=a.pop();d.dispatchEvent(b);d.age++;d.childNodes&&e.apply(a,d.childNodes)}this.currentScene.dispatchEvent(b);
this.dispatchEvent(b);this.dispatchEvent(new enchant.Event("exitframe"));this.frame++},stop:function(){if(this._intervalID)window.clearInterval(this._intervalID),this._intervalID=null;this.running=!1},pause:function(){if(this._intervalID)window.clearInterval(this._intervalID),this._intervalID=null},resume:function(){this.currentTime=Date.now();this._intervalID=window.setInterval(function(){c._tick()},1E3/this.fps);this.running=!0},pushScene:function(a){this._element.appendChild(a._element);this.currentScene&&
this.currentScene.dispatchEvent(new enchant.Event("exit"));this.currentScene=a;this.currentScene.dispatchEvent(new enchant.Event("enter"));return this._scenes.push(a)},popScene:function(){if(this.currentScene!=this.rootScene)return this._element.removeChild(this.currentScene._element),this.currentScene.dispatchEvent(new enchant.Event("exit")),this.currentScene=this._scenes[this._scenes.length-2],this.currentScene.dispatchEvent(new enchant.Event("enter")),this._scenes.pop()},replaceScene:function(a){this.popScene();
return this.pushScene(a)},removeScene:function(a){if(this.currentScene==a)return this.popScene();var b=this._scenes.indexOf(a);if(-1!=b)return this._scenes.splice(b,1),this._element.removeChild(a._element),a},keybind:function(a,b){this._keybind[a]=b}});enchant.Game.instance=null;enchant.Node=enchant.Class.create(enchant.EventTarget,{initialize:function(){enchant.EventTarget.call(this);this.age=this._offsetY=this._offsetX=this._y=this._x=0;this.scene=this.parentNode=null;this.addEventListener("touchstart",
function(a){this.parentNode&&this.parentNode!=this.scene&&this.parentNode.dispatchEvent(a)});this.addEventListener("touchmove",function(a){this.parentNode&&this.parentNode!=this.scene&&this.parentNode.dispatchEvent(a)});this.addEventListener("touchend",function(a){this.parentNode&&this.parentNode!=this.scene&&this.parentNode.dispatchEvent(a)})},moveTo:function(a,b){this._x=a;this._y=b;this._updateCoordinate()},moveBy:function(a,b){this._x+=a;this._y+=b;this._updateCoordinate()},x:{get:function(){return this._x},
set:function(a){this._x=a;this._updateCoordinate()}},y:{get:function(){return this._y},set:function(a){this._y=a;this._updateCoordinate()}},_updateCoordinate:function(){this.parentNode?(this._offsetX=this.parentNode._offsetX+this._x,this._offsetY=this.parentNode._offsetY+this._y):(this._offsetX=this._x,this._offsetY=this._y)},remove:function(){this._listener&&this.clearEventListener();this.parentNode&&this.removeChild(this)}});enchant.Entity=enchant.Class.create(enchant.Node,{initialize:function(){enchant.Node.call(this);
this._element=document.createElement("div");this._style=this._element.style;this._style.position="absolute";this._height=this._width=0;this._backgroundColor=null;this._opacity=1;this._visible=!0;this._buttonMode=null;if(enchant.Game.instance._debug)this._style.border="1px solid blue",this._style.margin="-1px";this.buttonMode=null;this.buttonPressed=!1;this.addEventListener("touchstart",function(){if(this.buttonMode){this.buttonPressed=!0;var a=new enchant.Event(this.buttonMode+"buttondown");this.dispatchEvent(a);
c.dispatchEvent(a)}});this.addEventListener("touchend",function(){if(this.buttonMode){this.buttonPressed=!1;var a=new enchant.Event(this.buttonMode+"buttonup");this.dispatchEvent(a);c.dispatchEvent(a)}});var a=this,b=function(){a.dispatchEvent(new enchant.Event("render"))};this.addEventListener("addedtoscene",function(){b();c.addEventListener("exitframe",b)});this.addEventListener("removedfromscene",function(){c.removeEventListener("exitframe",b)});this.addEventListener("render",function(){if(this._offsetX!=
this._previousOffsetX)this._style.left=this._offsetX+"px";if(this._offsetY!=this._previousOffsetY)this._style.top=this._offsetY+"px";this._previousOffsetX=this._offsetX;this._previousOffsetY=this._offsetY});a=this;l?(this._element.addEventListener("touchstart",function(b){for(var d=b.touches,c=0,h=d.length;c<h;c++)b=new enchant.Event("touchstart"),b.identifier=d[c].identifier,b._initPosition(d[c].pageX,d[c].pageY),a.dispatchEvent(b)},!1),this._element.addEventListener("touchmove",function(b){for(var d=
b.touches,c=0,h=d.length;c<h;c++)b=new enchant.Event("touchmove"),b.identifier=d[c].identifier,b._initPosition(d[c].pageX,d[c].pageY),a.dispatchEvent(b)},!1),this._element.addEventListener("touchend",function(b){for(var d=b.changedTouches,c=0,h=d.length;c<h;c++)b=new enchant.Event("touchend"),b.identifier=d[c].identifier,b._initPosition(d[c].pageX,d[c].pageY),a.dispatchEvent(b)},!1)):(this._element.addEventListener("mousedown",function(b){var d=b.pageX,m=b.pageY,b=new enchant.Event("touchstart");
b.identifier=c._mousedownID;b._initPosition(d,m);a.dispatchEvent(b);a._mousedown=!0},!1),c._element.addEventListener("mousemove",function(b){if(a._mousedown){var d=b.pageX,m=b.pageY,b=new enchant.Event("touchmove");b.identifier=c._mousedownID;b._initPosition(d,m);a.dispatchEvent(b)}},!1),c._element.addEventListener("mouseup",function(b){if(a._mousedown){var d=b.pageX,m=b.pageY,b=new enchant.Event("touchend");b.identifier=c._mousedownID;b._initPosition(d,m);a.dispatchEvent(b);a._mousedown=!1}},!1))},
id:{get:function(){return this._element.id},set:function(a){this._element.id=a}},className:{get:function(){return this._element.className},set:function(a){this._element.className=a}},width:{get:function(){return this._width},set:function(a){this._style.width=(this._width=a)+"px"}},height:{get:function(){return this._height},set:function(a){this._style.height=(this._height=a)+"px"}},backgroundColor:{get:function(){return this._backgroundColor},set:function(a){this._element.style.backgroundColor=this._backgroundColor=
a}},opacity:{get:function(){return this._opacity},set:function(a){this._style.opacity=this._opacity=a}},visible:{get:function(){return this._visible},set:function(a){this._style.display=(this._visible=a)?"block":"none"}},touchEnabled:{get:function(){return this._touchEnabled},set:function(a){this._style.pointerEvents=(this._touchEnabled=a)?"all":"none"}},intersect:function(a){return this.x<a.x+a.width&&a.x<this.x+this.width&&this.y<a.y+a.height&&a.y<this.y+this.height},within:function(a,b){null==
b&&(b=(this.width+this.height+a.width+a.height)/4);var e;return(e=this.x-a.x+(this.width-a.width)/2)*e+(e=this.y-a.y+(this.height-a.height)/2)*e<b*b}});enchant.Sprite=enchant.Class.create(enchant.Entity,{initialize:function(a,b){enchant.Entity.call(this);this.width=a;this.height=b;this._scaleY=this._scaleX=1;this._rotation=0;this._dirty=!1;this._image=null;this._frame=0;this._style.overflow="hidden";this.addEventListener("render",function(){if(this._dirty)this._style[g+"Transform"]=["rotate(",this._rotation,
"deg)scale(",this._scaleX,",",this._scaleY,")"].join(""),this._dirty=!1});if(enchant.Game.instance._debug)this._style.border="1px solid red",this._style.margin="-1px",this.addEventListener("touchstart",function(){enchant.Game.instance.running||console.log("touchstart",this)})},image:{get:function(){return this._image},set:function(a){if(a!=this._image){if(null!=this._image)if(this._image.css)this._style.backgroundImage="";else if(this._element.firstChild)this._element.removeChild(this._element.firstChild),
this._dirtyListener?(this.removeEventListener("render",this._dirtyListener),this._dirtyListener=null):this._image._parent=null;if(null!=a)if(a._css)this._style.backgroundImage=a._css;else if(a._parent){var b=document.createElement("canvas"),e=b.getContext("2d");b.width=a.width;b.height=a.height;e.drawImage(a._element,0,0);this._dirtyListener=function(){if(a._dirty)e.drawImage(a._element),a._dirty=!1};this.addEventListener("render",this._dirtyListener);this._element.appendChild(b)}else a._parent=this,
this._element.appendChild(a._element);this._image=a;this.frame=this.frame}}},frame:{get:function(){return this._frame},set:function(a){this._frame=a;if(null!=this._image){var b=this._image.width/this._width|0;if(this._image._css)this._style.backgroundPosition=[-(a%b)*this._width,"px ",-(a/b|0)*this._height,"px"].join("");else if(this._element.firstChild){var e=this._element.firstChild.style;e.left=-(a%b)*this._width+"px";e.top=-(a/b|0)*this._height+"px"}}}},scale:function(a,b){null==b&&(b=a);this._scaleX*=
a;this._scaleY*=b;this._dirty=!0},rotate:function(a){this._rotation+=a;this._dirty=!0},scaleX:{get:function(){return this._scaleX},set:function(a){this._scaleX=a;this._dirty=!0}},scaleY:{get:function(){return this._scaleY},set:function(a){this._scaleY=a;this._dirty=!0}},rotation:{get:function(){return this._rotation},set:function(a){this._rotation=a;this._dirty=!0}}});enchant.Label=enchant.Class.create(enchant.Entity,{initialize:function(a){enchant.Entity.call(this);this.width=300;this.text=a},text:{get:function(){return this._element.innerHTML},
set:function(a){this._element.innerHTML=a}},font:{get:function(){return this._style.font},set:function(a){this._style.font=a}},color:{get:function(){return this._style.color},set:function(a){this._style.color=a}}});enchant.Map=enchant.Class.create(enchant.Entity,{initialize:function(a,b){enchant.Entity.call(this);var e=document.createElement("canvas");f&&2==c.scale?(e.width=2*c.width,e.height=2*c.height,this._style.webkitTransformOrigin="0 0",this._style.webkitTransform="scale(0.5)"):(e.width=c.width,
e.height=c.height);this._element.appendChild(e);this._context=e.getContext("2d");this._tileWidth=a||0;this._tileHeight=b||0;this._image=null;this._data=[[[]]];this.touchEnabled=this._tight=this._dirty=!1;this.collisionData=null;this._listeners.render=null;this.addEventListener("render",function(){if(this._dirty||null==this._previousOffsetX)this._dirty=!1,this.redraw(0,0,c.width,c.height);else if(this._offsetX!=this._previousOffsetX||this._offsetY!=this._previousOffsetY)if(this._tight){var a=-this._offsetX,
b=-this._offsetY,e=-this._previousOffsetX,i=-this._previousOffsetY,g=a-e+c.width,k=e-a+c.width,j=b-i+c.height,f=i-b+c.height;if(g>this._tileWidth&&k>this._tileWidth&&j>this._tileHeight&&f>this._tileHeight){var l;g<k?(l=0,a=e-a,k=g):(l=a-e,a=0);j<f?(g=0,b=i-b):(g=b-i,b=0,j=f);if(null==c._buffer)c._buffer=document.createElement("canvas"),c._buffer.width=this._context.canvas.width,c._buffer.height=this._context.canvas.height;f=c._buffer.getContext("2d");this._doubledImage?(f.clearRect(0,0,2*k,2*j),f.drawImage(this._context.canvas,
2*l,2*g,2*k,2*j,0,0,2*k,2*j),f=this._context,f.clearRect(2*a,2*b,2*k,2*j),f.drawImage(c._buffer,0,0,2*k,2*j,2*a,2*b,2*k,2*j)):(f.clearRect(0,0,k,j),f.drawImage(this._context.canvas,l,g,k,j,0,0,k,j),f=this._context,f.clearRect(a,b,k,j),f.drawImage(c._buffer,0,0,k,j,a,b,k,j));0==a?this.redraw(k,0,c.width-k,c.height):this.redraw(0,0,c.width-k,c.height);0==b?this.redraw(0,j,c.width,c.height-j):this.redraw(0,0,c.width,c.height-j)}else this.redraw(0,0,c.width,c.height)}else this.redraw(0,0,c.width,c.height);
this._previousOffsetX=this._offsetX;this._previousOffsetY=this._offsetY})},loadData:function(a){this._data=Array.prototype.slice.apply(arguments);this._dirty=!0;this._tight=!1;for(var b=0,e=this._data.length;b<e;b++){for(var d=0,a=this._data[b],c=0,h=a.length;c<h;c++)for(var i=0,g=a[c].length;i<g;i++)0<=a[c][i]&&d++;if(0.2<d/(a.length*a[0].length)){this._tight=!0;break}}},hitTest:function(a,b){if(0>a||this.width<=a||0>b||this.height<=b)return!1;var e=this._image.width,d=this._image.height,c=this._tileWidth||
e,h=this._tileHeight||d,a=a/c|0,b=b/h|0;if(null!=this.collisionData)return this.collisionData[b]&&!!this.collisionData[b][a];for(var i=0,g=this._data.length;i<g;i++){var f=this._data[i],j;if(null!=f[b]&&null!=(j=f[b][a])&&0<=j&&j<(e/c|0)*(d/h|0))return!0}return!1},image:{get:function(){return this._image},set:function(a){this._image=a;if(f&&2==c.scale){for(var b=new enchant.Surface(2*a.width,2*a.height),e=this._tileWidth||a.width,d=this._tileHeight||a.height,m=a.width/e|0,h=a.height/d|0,i=0;i<h;i++)for(var g=
0;g<m;g++)b.draw(a,g*e,i*d,e,d,2*g*e,2*i*d,2*e,2*d);this._doubledImage=b}this._dirty=!0}},tileWidth:{get:function(){return this._tileWidth},set:function(a){this._tileWidth=a;this._dirty=!0}},tileHeight:{get:function(){return this._tileHeight},set:function(a){this._tileHeight=a;this._dirty=!0}},width:{get:function(){return this._tileWidth*this._data[0][0].length}},height:{get:function(){return this._tileHeight*this._data[0].length}},redraw:function(a,b,e,d){if(null!=this._image){var c,h,i,g,f;this._doubledImage?
(c=this._doubledImage,h=2*this._tileWidth,i=2*this._tileHeight,g=2*-this._offsetX,f=2*-this._offsetY,a*=2,b*=2,e*=2,d*=2):(c=this._image,h=this._tileWidth,i=this._tileHeight,g=-this._offsetX,f=-this._offsetY);var j=c.width/h|0,l=c.height/i|0,n=Math.max((a+g)/h|0,0),t=Math.max((b+f)/i|0,0),u=Math.ceil((a+g+e)/h),q=Math.ceil((b+f+d)/i);c=c._element;var s=this._context;s.clearRect(a,b,e,d);e=0;for(d=this._data.length;e<d;e++)for(var r=this._data[e],v=Math.min(u,r[0].length),w=Math.min(q,r.length),b=
t;b<w;b++)for(a=n;a<v;a++){var p=r[b][a];0<=p&&p<j*l&&s.drawImage(c,p%j*h,(p/j|0)*i,h,i,a*h-g,b*i-f,h,i)}}}});enchant.Group=enchant.Class.create(enchant.Node,{initialize:function(){enchant.Node.call(this);this.childNodes=[];this._y=this._x=0},addChild:function(a){this.childNodes.push(a);a.parentNode=this;a.dispatchEvent(new enchant.Event("added"));if(this.scene){var b=new enchant.Event("addedtoscene");a.scene=this.scene;a.dispatchEvent(b);a._updateCoordinate();var e=document.createDocumentFragment(),
d,c=Array.prototype.push;if(a._element)e.appendChild(a._element);else if(a.childNodes)for(d=a.childNodes.slice().reverse();d.length;)a=d.pop(),a.scene=this.scene,a.dispatchEvent(b),a._element?e.appendChild(a._element):a.childNodes&&c.apply(d,a.childNodes.reverse());if(e.childNodes.length){for(var h,b=this;b.parentNode;){d=b.parentNode.childNodes;for(d=d.slice(d.indexOf(b)+1).reverse();d.length;)if(a=d.pop(),a._element){h=a._element;break}else a.childNodes&&c.apply(d,a.childNodes.slice().reverse());
b=b.parentNode}h?this.scene._element.insertBefore(e,h):this.scene._element.appendChild(e)}}},insertBefore:function(a,b){var e=this.childNodes.indexOf(b);if(-1!=e){if(this.childNodes.splice(e,0,a),a.parentNode=this,a.dispatchEvent(new enchant.Event("added")),this.scene){var d=new enchant.Event("addedtoscene");a.scene=this.scene;a.dispatchEvent(d);a._updateCoordinate();var c=document.createDocumentFragment(),h,g=Array.prototype.push;if(a._element)c.appendChild(a._element);else if(a.childNodes)for(h=
a.childNodes.slice().reverse();h.length;)a=h.pop(),a.scene=this.scene,a.dispatchEvent(d),a._element?c.appendChild(a._element):a.childNodes&&g.apply(h,a.childNodes.reverse());if(c.childNodes.length){for(var f,d=b;d.parentNode;){null!=e?(h=this.childNodes.slice(e+1).reverse(),e=null):(h=d.parentNode.childNodes,h=h.slice(h.indexOf(d)+1).reverse());for(;h.length;)if(a=h.pop(),a._element){f=a._element;break}else a.childNodes&&g.apply(h,a.childNodes.slice().reverse());d=d.parentNode}f?this.scene._element.insertBefore(c,
f):this.scene._element.appendChild(c)}}}else this.addChild(a)},removeChild:function(a){var b=this.childNodes.indexOf(a);if(-1!=b&&(this.childNodes.splice(b,1),a.parentNode=null,a.dispatchEvent(new enchant.Event("removed")),this.scene))if(b=new enchant.Event("removedfromscene"),a.scene=null,a.dispatchEvent(b),a._element)this.scene._element.removeChild(a._element);else if(a.childNodes)for(var e=a.childNodes.slice(),d=Array.prototype.push;e.length;)a=e.pop(),a.scene=null,a.dispatchEvent(b),a._element?
this.scene._element.removeChild(a._element):a.childNodes&&d.apply(e,a.childNodes)},firstChild:{get:function(){return this.childNodes[0]}},lastChild:{get:function(){return this.childNodes[this.childNodes.length-1]}},_updateCoordinate:function(){this.parentNode?(this._offsetX=this.parentNode._offsetX+this._x,this._offsetY=this.parentNode._offsetY+this._y):(this._offsetX=this._x,this._offsetY=this._y);for(var a=0,b=this.childNodes.length;a<b;a++)this.childNodes[a]._updateCoordinate()}});enchant.Scene=
enchant.Class.create(enchant.Group,{initialize:function(){enchant.Group.call(this);this._element=document.createElement("div");this._element.style.position="absolute";this._element.style.overflow="hidden";this._element.style.width=(this.width=c.width)+"px";this._element.style.height=(this.height=c.height)+"px";this._element.style[g+"TransformOrigin"]="0 0";this._element.style[g+"Transform"]="scale("+c.scale+")";this.scene=this;var a=this;l?(this._element.addEventListener("touchstart",function(b){for(var e=
b.touches,d=0,c=e.length;d<c;d++)b=new enchant.Event("touchstart"),b.identifier=e[d].identifier,b._initPosition(e[d].pageX,e[d].pageY),a.dispatchEvent(b)},!1),this._element.addEventListener("touchmove",function(b){for(var e=b.touches,d=0,c=e.length;d<c;d++)b=new enchant.Event("touchmove"),b.identifier=e[d].identifier,b._initPosition(e[d].pageX,e[d].pageY),a.dispatchEvent(b)},!1),this._element.addEventListener("touchend",function(b){for(var c=b.changedTouches,d=0,g=c.length;d<g;d++)b=new enchant.Event("touchend"),
b.identifier=c[d].identifier,b._initPosition(c[d].pageX,c[d].pageY),a.dispatchEvent(b)},!1)):(this._element.addEventListener("mousedown",function(b){var e=b.pageX,d=b.pageY,b=new enchant.Event("touchstart");b.identifier=c._mousedownID;b._initPosition(e,d);a.dispatchEvent(b);a._mousedown=!0},!1),c._element.addEventListener("mousemove",function(b){if(a._mousedown){var e=b.pageX,d=b.pageY,b=new enchant.Event("touchmove");b.identifier=c._mousedownID;b._initPosition(e,d);a.dispatchEvent(b)}},!1),c._element.addEventListener("mouseup",
function(b){if(a._mousedown){var e=b.pageX,d=b.pageY,b=new enchant.Event("touchend");b.identifier=c._mousedownID;b._initPosition(e,d);a.dispatchEvent(b);a._mousedown=!1}},!1))},backgroundColor:{get:function(){return this._backgroundColor},set:function(a){this._element.style.backgroundColor=this._backgroundColor=a}},_updateCoordinate:function(){this._offsetX=this._x;this._offsetY=this._y;for(var a=0,b=this.childNodes.length;a<b;a++)this.childNodes[a]._updateCoordinate()}});var n="putImageData,drawImage,drawFocusRing,fill,stroke,clearRect,fillRect,strokeRect,fillText,strokeText".split(",");
enchant.Surface=enchant.Class.create(enchant.EventTarget,{initialize:function(a,b){enchant.EventTarget.call(this);this.width=a;this.height=b;this.context=null;var e="enchant-surface"+c._surfaceID++;document.getCSSCanvasContext?(this.context=document.getCSSCanvasContext("2d",e,a,b),this._element=this.context.canvas,this._css="-webkit-canvas("+e+")"):document.mozSetImageElement?(this._element=document.createElement("canvas"),this._element.width=a,this._element.height=b,this._css="-moz-element(#"+e+
")",this.context=this._element.getContext("2d"),document.mozSetImageElement(e,this._element)):(this._element=document.createElement("canvas"),this._element.width=a,this._element.height=b,this._element.style.position="absolute",this.context=this._element.getContext("2d"),n.forEach(function(a){var b=this.context[a];this.context[a]=function(){b.apply(this,arguments);this._dirty=!0}},this))},getPixel:function(a,b){return this.context.getImageData(a,b,1,1).data},setPixel:function(a,b,c,d,g,h){var f=this.context.createImageData(1,
1);f.data[0]=c;f.data[1]=d;f.data[2]=g;f.data[3]=h;this.context.putImageData(f,a,b,1,1)},clear:function(){this.context.clearRect(0,0,this.width,this.height)},draw:function(a){arguments[0]=a=a._element;1==arguments.length?this.context.drawImage(a,0,0):this.context.drawImage.apply(this.context,arguments)},clone:function(){var a=new enchant.Surface(this.width,this.height);a.draw(this);return a},toDataURL:function(){var a=this._element.src;return a?"data:"==a.slice(0,5)?a:this.clone().toDataURL():this._element.toDataURL()}});
enchant.Surface.load=function(a){var b=new Image,c=Object.create(Surface.prototype,{context:{value:null},_css:{value:"url("+a+")"},_element:{value:b}});enchant.EventTarget.call(c);b.src=a;b.onerror=function(){throw Error("Cannot load an asset: "+b.src);};b.onload=function(){c.width=b.width;c.height=b.height;c.dispatchEvent(new enchant.Event("load"))};return c};enchant.Sound=enchant.Class.create(enchant.EventTarget,{initialize:function(){enchant.EventTarget.call(this);throw Error("Illegal Constructor");
},play:function(){this._element&&this._element.play()},pause:function(){this._element&&this._element.pause()},stop:function(){this.pause();this.currentTime=0},clone:function(){var a;a=this._element instanceof Audio?Object.create(enchant.Sound.prototype,{_element:{value:this._element.cloneNode(!1)},duration:{value:this.duration}}):Object.create(enchant.Sound.prototype);enchant.EventTarget.call(a);return a},currentTime:{get:function(){return this._element?this._element.currentTime:0},set:function(a){if(this._element)this._element.currentTime=
a}},volume:{get:function(){return this._element?this._element.volume:1},set:function(a){if(this._element)this._element.volume=a}}});enchant.Sound.load=function(a,b){if(null==b)var e=a.match(/\.\w+$/)[0],b=e?"audio/"+e.slice(1).toLowerCase():"";var b=b.replace("mp3","mpeg"),d=Object.create(enchant.Sound.prototype);enchant.EventTarget.call(d);var f=new Audio;if(!enchant.Sound.enabledInMobileSafari&&"webkit"==g&&l)window.setTimeout(function(){d.dispatchEvent(new enchant.Event("load"))},0);else if(f.canPlayType(b))f.src=
a,f.load(),f.autoplay=!1,f.onerror=function(){throw Error("Cannot load an asset: "+f.src);},f.addEventListener("canplaythrough",function(){d.duration=f.duration;d.dispatchEvent(new enchant.Event("load"))},!1),d._element=f;else if("audio/mpeg"==b){var h=document.createElement("embed"),e="enchant-audio"+c._soundID++;h.width=h.height=1;h.name=e;h.src="sound.swf?id="+e+"&src="+a;h.allowscriptaccess="always";h.style.position="absolute";h.style.left="-1px";d.addEventListener("load",function(){Object.defineProperties(h,
{currentTime:{get:function(){return h.getCurrentTime()},set:function(a){h.setCurrentTime(a)}},volume:{get:function(){return h.getVolume()},set:function(a){h.setVolume(a)}}});d._element=h;d.duration=h.getDuration()});c._element.appendChild(h);enchant.Sound[e]=d}else window.setTimeout(function(){d.dispatchEvent(new enchant.Event("load"))},0);return d};window.addEventListener("message",function(a){a=JSON.parse(a.data);if("event"==a.type)c.dispatchEvent(new Event(a.value));else if("debug"==a.type)switch(a.value){case "start":enchant.Game.instance.start();
break;case "pause":enchant.Game.instance.pause();break;case "resume":enchant.Game.instance.resume();break;case "tick":enchant.Game.instance._tick()}});enchant.Sound.enabledInMobileSafari=!1})();
>>>>>>> parent of 5145367... v0.5.0
